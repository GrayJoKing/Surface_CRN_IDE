(this.webpackJsonpsurface_crn_ide=this.webpackJsonpsurface_crn_ide||[]).push([[0],{114:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(s(153));t.default=class{constructor(e){this.original_string="",this.matched=[],this.update_matched(e)}includes(e){return this.matched.includes(e)}is_pure(){return null===this.original_string.match(/^\w+$/)}toString(){return this.original_string}update_matched(e){this.original_string=e,this.matched=a.default.decompose(e)}}},135:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(s(114));class r{constructor(e){this.red=0,this.green=0,this.blue=0,this.species=new Set,this.name="",this.hexString="","string"===typeof e&&(e=r.hex2rgb(e)),this.update_colour(e)}static white(){return new r({red:256,green:256,blue:256})}rgb(){return[this.red,this.green,this.blue]}hex(){return this.hexString}update_colour(e){Object.assign(this,e),this.hexString="#"+this.rgb().map((e=>("0"+e.toString(16)).slice(-2))).join("")}add_matcher(e){this.species.add(new a.default(e))}delete_matcher(e){this.species.delete(e)}static hex2rgb(e){let t=(e=e.replace(/^#/,"")).match(/^([A-Fa-f\d]{2})([A-Fa-f\d]{2})([A-Fa-f\d]{2})$/);return t?{red:parseInt(t[1],16),green:parseInt(t[2],16),blue:parseInt(t[3],16)}:{red:256,green:256,blue:256}}}t.default=r},153:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(s(224));t.default=class{static decompose(e){var t=[];for(var s of e)if("([{".includes(s))t.push(s);else if(")]}".includes(s)&&!"() {} []".includes(t.pop()+s))throw"Unbalanced brackets";if(0!==t.length)throw"Unbalanced brackets";return this.parse(e)}static parse(e,t=1,s=NaN){var i;if(""===e)return[""];if(i=e.match(/^((?:\w|\\\d+|\\<\d+>))\?(.*)$/))return this.parse(i[2],t,s).map((e=>[i[1]+e,e])).flat();if(i=e.match(/^((?:\w|\\\d+|\\<\d+>| \+ | \-> )+)(?!\?)(.*)$/))return this.parse(i[2],t,s).map((e=>i[1]+e));if("{"===e[0]){var r=(d=a.default.matchRecursive(e,"\\{","\\}\\??","g",{valueNames:["between","left","match","right"]})).slice(3).map((e=>e.value)).join("");if(isNaN(s)){var l=0,n=d[1].value.match(/^\w+$/)?d[1].value.split("").map((e=>[e])):d[1].value.split("|").map((e=>this.parse(e,t,l++)));return l=0,n.map((e=>{var s=this.parse(r,t,l++),i=s.map((t=>e.map((e=>e+t)))).flat();return"}?"===d[2].value&&(i=i.concat(s)),i})).flat()}var o=d[1].value.match(/^\w+$/)?d[1].value.split(""):d[1].value.split("|").map((e=>this.parse(e,t,s))).flat();if(s>o.length)throw"Uneven_Curly_Groups";var h=this.parse(r,t,s),c=h.map((e=>this.parse(o[s],t,s)+e));return"}?"===d[2].value&&(c=c.concat(h)),c}if("["===e[0]){o=(d=a.default.matchRecursive(e,"\\[","\\]\\??","g",{valueNames:["between","left","match","right"]}))[1].value.match(/^\w+$/)?d[1].value.split(""):d[1].value.split("|").map((e=>this.parse(e,t,s))).flat();return"]?"===d[2].value&&o.push(""),this.parse(d.slice(3).map((e=>e.value)).join(""),t,s).map((e=>o.map((t=>t+e)))).flat()}if("("===e[0]){var d;o=(d=a.default.matchRecursive(e,"\\(","\\)\\??","g",{valueNames:["between","left","match","right"]}))[1].value.match(/^\w+$/)?d[1].value.split(""):d[1].value.split("|").map((e=>this.parse(e,t,s))).flat();return")?"===d[2].value&&o.push(""),this.parse(d.slice(3).map((e=>e.value)).join(""),t+1,s).map((e=>o.map((s=>s+e.replace(new RegExp("\\\\"+t+"|\\\\<"+t+">","g"),s))))).flat()}throw"Unknown Character "+e[0]}}},188:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(s(153));class r{constructor(e){this.is_mono=!0,this.reactants=[],this.products=[],this.decomposed=[],this.rate=1,this.update(e)}toString(){return"("+this.rate.toString()+") "+[this.reactants,this.products].map((e=>e.map((e=>e.toString())).join(" + "))).join(" -> ")}update(e){if(Object.assign(this,e),this.reactants.length!==this.products.length)throw"Reactants and products are not equal length";this.is_mono=this.reactants.length<2&&this.products.length<2,this.decomposed=a.default.decompose(this.reactants.join(" + ")+" -> "+this.products.join(" + ")).map((e=>e.split(/ \+ | \-> /))).filter((e=>e.every((e=>""!==e))))}static blankRule(){return new r({is_mono:!0,reactants:[""],products:[""]})}matches(e,t){return this.is_mono===(void 0!==t)?[]:this.is_mono?this.decomposed.filter((t=>t[0]===e)).map((e=>[e[1]])):this.decomposed.filter((s=>s[0]===e&&s[1]===t)).map((e=>[e[2],e[3]]))}}t.default=r},368:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(s(135));t.default=class{constructor(e){this.colours=new Set,this.cache=new Map,this.example_colours=["#ffffff","#000000","#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#42d4f4","#f032e6","#bfef45","#fabed4","#469990","#dcbeff","#9A6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#a9a9a9"].map((e=>new a.default(e))),this.temp_colours=new Map,e&&(this.colours=e)}equals(e){return!(![...e.colours].filter((e=>!this.colours.has(e)))&&![...this.colours].filter((t=>!e.colours.has(t))))}find_colour(e){let t=this.cache.get(e);if(void 0===t){for(let s of this.colours)if([...s.species.values()].some((t=>t.includes(e)))){t=s;break}void 0===t&&(t=this.temp_colours.get(e),void 0===t&&(t=this.new_colour(),void 0===t&&(t=new a.default("#FFFFFF")),this.add_temp(e,t),this.cache.set(e,t)))}return t}export(){return[...this.colours.values()].map((e=>"{"+e.name+"} "+[...e.species.values()].map((e=>e.toString())).join(" ")+" : ("+e.rgb().join(",")+")"))}new_colour(){this.cache.clear();let e=this.example_colours.find((e=>void 0===[...this.temp_colours.values(),...this.colours.values()].find((t=>t.hex()===e.hex()))));return void 0===e?new a.default("#000000"):e}add(e){this.cache.clear(),this.colours.add(e)}delete(e){this.cache.clear(),this.colours.delete(e)}add_temp(e,t){this.cache.clear(),this.temp_colours.set(e,t)}clear_temp(){this.cache.clear(),this.temp_colours.clear()}}},369:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){this.old_cells=[],this.new_cells=[],this.new_transitions=null,this.update_time=e,this.execution_time=t}add_old_cell(e,t,s){this.old_cells.push([e,t,s])}add_new_cell(e,t,s){this.new_cells.push([e,t,s])}add_future_transitions(e){this.new_transitions=e}}},370:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parse_import_files=t.parse_code=void 0;const a=i(s(114)),r=i(s(188)),l=i(s(135)),n=i(s(58));function o(e,t){var s=function(e){if(1!=(e.match(/->/g)||[]).length)return!1;let t=1;e=e.replace(/\((\d*(?:\.\d+)?)\)/,((e,s)=>(t=+s,"")));let[s,i]=e.split("->").map((e=>e.split("+").map((e=>e.trim()))));return!(s.length!=i.length||s.length>2||0==s.length)&&new r.default({reactants:s,products:i,rate:t,is_mono:1==s.length})}(e);if(!1!==s)return t.rules.push(s),!0;var i=function(e){let t=e.match(/^(?:\{([^}]+)\})? *((?: *[^,: ]+,? *?)+) *: *\((\d+) *, *(\d+) *, *(\d+)\)$/);if(null==t)return!1;var s=t[2].split(/,\s*|\s+/).map((e=>new a.default(e.trim())));return new l.default({name:t[1]||t[2],species:new Set(s),red:+t[3],green:+t[4],blue:+t[5]})}(e);if(!1!==i)return t.colour_map.add(i),!0;var n=function(e){return 1==(e.match(/=/g)||[]).length&&e.split("=").map((e=>e.trim()))}(e);if(!1!==n){let[e,s]=n;return t.set_option(e,s),!0}return!1}function h(e){return e.split(/\s+|,/)}function c(e){let t=!1,s=new n.default;for(let i of e)if(i=i.trim().replace(/#.*/,""),""!=i)if(t){if("!END_INIT_STATE"==i){t=!1;continue}let e=h(i);s.initial_state.push(e)}else{if("!START_INIT_STATE"==i){t=!0;continue}o(i,s)}return s}t.parse_code=c,t.parse_import_files=async function(e){if(!e)return!1;class t{constructor(){this.data=[],this.imported=!1}}let s=new Map;for(let r of e){var i=new t;i.data=(await r.text()).split("\n").map((e=>e.trim().replace(/#.*/,""))),s.set(r.name,i)}for(let[r,l]of s)for(let e of l.data)e.match(/^!INCLUDE /);let a=[];for(let[r,l]of s)l.imported||a.push(...l.data);return c(a)}},374:function(e,t,s){},386:function(e,t,s){"use strict";s.r(t);var i=s(0),a=s.n(i),r=s(54),l=s.n(r),n=s(58),o=s.n(n),h=(s(374),s(195)),c=s.n(h),d=s(194),u=s.n(d),p=s(196),m=s.n(p),_=s(193),f=s.n(_),x=s(197),b=s.n(x),j=s(192),g=s.n(j),v=s(191),w=s.n(v),y=s(450),S=s(449),O=s(444),C=s(1);class k extends a.a.Component{constructor(...e){super(...e),this.stopButton=null,this.fastBackward=null,this.stepBackward=null,this.playButton=null,this.stepForward=null,this.fastForward=null}render(){return Object(C.jsxs)(O.a,{item:!0,container:!0,xs:12,children:[Object(C.jsx)(O.a,{item:!0,xs:12,sm:8,children:Object(C.jsx)(S.a,{variant:"h3",className:"grid title",children:"Surface CRN Simulator"})}),Object(C.jsxs)(O.a,{item:!0,xs:12,sm:4,children:[Object(C.jsxs)(y.a,{onClick:this.props.stopPressed,children:[" ",Object(C.jsx)(w.a,{sx:{fontSize:40}})," "]}),Object(C.jsxs)(y.a,{onClick:this.props.fastBackwardPressed,children:[" ",Object(C.jsx)(g.a,{sx:{fontSize:40}})," "]}),Object(C.jsxs)(y.a,{onClick:this.props.stepBackPressed,children:[" ",Object(C.jsx)(f.a,{sx:{fontSize:40}})," "]}),Object(C.jsx)(y.a,{onClick:this.props.playPressed,children:this.props.simPlaying?Object(C.jsx)(u.a,{sx:{fontSize:40}}):Object(C.jsx)(c.a,{sx:{fontSize:40}})}),Object(C.jsxs)(y.a,{onClick:this.props.stepForwardPressed,children:[" ",Object(C.jsx)(m.a,{sx:{fontSize:40}})," "]}),Object(C.jsxs)(y.a,{onClick:this.props.fastForwardPressed,children:[" ",Object(C.jsx)(b.a,{sx:{fontSize:40}})," "]})]})]})}}class R{constructor(e=0,t=0){this.x=void 0,this.y=void 0,this.x=e,this.y=t}add(e){return new R(this.x+e.x,this.y+e.y)}subtract(e){return new R(this.x-e.x,this.y-e.y)}multiply(e){return new R(this.x*e.x,this.y*e.y)}scale(e){return new R(this.x*e,this.y*e)}equals(e){return this.x===e.x&&this.y===e.y}magnitude(){return Math.sqrt(this.x**2+this.y**2)}}R.origin=new R(0,0);var P=R;class z extends a.a.Component{constructor(e){super(e),this.canvas=null,this.mouseDown=!1,this.mousePosition=null,this.mouseMoved=!1,this.state={data:this.createData(e.current_state),offset:P.origin,selected_cells:[],sim_time:e.simulation?0:null}}render(){return Object(C.jsx)("canvas",{ref:e=>this.canvas=e})}componentDidMount(){this.canvas.addEventListener("wheel",this.scrollZoom.bind(this),{passive:!1}),this.canvas.addEventListener("mousedown",this.mouseEvents.bind(this)),this.canvas.addEventListener("mouseup",this.mouseEvents.bind(this)),this.canvas.addEventListener("mousemove",this.mouseEvents.bind(this)),this.canvas.addEventListener("dblclick",this.mouseEvents.bind(this)),this.canvas.addEventListener("mouseenter",this.mouseEvents.bind(this)),this.canvas.addEventListener("mouseleave",this.mouseEvents.bind(this)),this.draw()}hexCoord(e,t){let s,i=1.125*this.props.size,a=this.props.size*Math.sin(2*Math.PI/6)*2*.75,r=.375*this.props.size,l=r/(a/2),n=Math.floor((t+r/2)/i),o=1===(1&n);s=Math.floor(e/a-(o?.5:0));let h=t+r/2-n*i,c=e-s*a-(o?a/2:0);return h<-l*c+r?(n--,o||s--):h<l*c-r&&(n--,o&&s++),[s,n]}mouseEvents(e){switch(e.type){case"mousedown":this.mouseDown=!0,this.mousePosition=new P(e.x,e.y);break;case"mouseenter":case"mouseleave":case"mouseup":if(this.mouseDown&&!this.mouseMoved){const t=this.canvas.getBoundingClientRect(),s=e.x-this.state.offset.x-t.x,i=e.y-this.state.offset.y-t.y;if("square"===this.props.geometry)this.setState({selected_cells:[new P(Math.floor(s/this.props.size),Math.floor(i/this.props.size))]});else if("hex"===this.props.geometry){let[e,t]=this.hexCoord(s,i);this.setState({selected_cells:[new P(Math.floor(e),Math.floor(t))]})}}this.mouseDown=!1,this.mouseMoved=!1,this.mousePosition=null;break;case"mousemove":if(this.mouseDown){let t=this.mousePosition.subtract(new P(e.x,e.y));(this.mouseMoved||t.magnitude()>5)&&(this.mousePosition=new P(e.x,e.y),this.mouseMoved=!0,this.setState({offset:this.state.offset.subtract(t)}))}}return e.preventDefault(),!1}componentDidUpdate(e,t){if(e.model!==this.props.model||e.geometry!==this.props.geometry||!t.offset.equals(this.state.offset)||e.size!==this.props.size||null!==t.sim_time&&t.sim_time>0&&0===this.state.sim_time)this.draw();else if(e.current_state!==this.props.current_state&&this.setState({data:this.createData(this.props.current_state)}),t!==this.state){if(t.selected_cells!==this.state.selected_cells){let e=this.state.selected_cells.length<1?"":null;for(let t of this.state.selected_cells){var s,i;let a=((null===(s=this.state.data)||void 0===s||null===(i=s[t.y])||void 0===i?void 0:i[t.x])||[""])[0];null===e&&(e=a),e!==a&&(e="")}this.props.selectedCells(this.state.selected_cells,e)}let e=this.canvas.getContext("2d");if(null===e||!(e instanceof CanvasRenderingContext2D))return;const l=e;if(t.data!==this.state.data){let e=0;for(let[s,i]of this.state.data.entries())for(let[n,o]of i.entries()){var a,r;let i=null===(a=t.data)||void 0===a||null===(r=a[s])||void 0===r?void 0:r[n];void 0!==i&&i[0]===o[0]&&i[1].hex()===o[1].hex()||this.drawCell(l,n,s,o)&&e++}}this.addExtraDetail(l,t)}}scrollZoom(e){let t=1;e.deltaY<0?t=this.props.zoom(!0):e.deltaY>0&&(t=this.props.zoom(!1)),e.preventDefault();const s=this.canvas.getBoundingClientRect(),i=(this.state.offset.x-e.x+s.x)/t+e.x-s.x,a=(this.state.offset.y-e.y+s.y)/t+e.y-s.y;this.setState({offset:new P(i,a)})}draw(){if(null===this.canvas)return;const e=this.canvas.parentNode.getBoundingClientRect();this.canvas.width=Math.floor(e.width*window.devicePixelRatio),this.canvas.height=Math.floor(e.height*window.devicePixelRatio),this.canvas.style.width=Math.floor(e.width)+"px",this.canvas.style.height=Math.floor(e.height)+"px";const t=this.canvas.getContext("2d");if(null===t||!(t instanceof CanvasRenderingContext2D))return;const s=t;s.clearRect(0,0,s.canvas.width,s.canvas.height),s.scale(window.devicePixelRatio,window.devicePixelRatio),s.translate(this.state.offset.x,this.state.offset.y);let i=this.createData(this.props.current_state);for(let[a,r]of i.entries())for(let[e,t]of r.entries())this.drawCell(s,e,a,t);this.addExtraDetail(s)}addExtraDetail(e,t){if(null!==this.state.sim_time){e.fillStyle="#FFFFFF";let t=e.canvas.width/window.devicePixelRatio-80-this.state.offset.x,s=e.canvas.height/window.devicePixelRatio-30-this.state.offset.y;e.fillRect(t,s,80,30),e.fillStyle="#000000",e.textAlign="left",e.textBaseline="middle",e.font="15px Arial",e.fillText("T: "+this.state.sim_time.toFixed(2),t+4,s+15,80)}for(let n of[t,this.state])if(void 0!==n)for(let o of n.selected_cells){var s,i;if(e.lineWidth=1,e.strokeStyle="rgba(0,204,256,0.3)",e.fillStyle=e.strokeStyle,"square"===this.props.geometry)if(n===t)this.drawCell(e,o.x,o.y,null===(s=this.state.data)||void 0===s||null===(i=s[o.y])||void 0===i?void 0:i[o.x]);else e.fillRect(o.x*this.props.size,o.y*this.props.size,this.props.size,this.props.size);else if("hex"===this.props.geometry)if(n===t){var a,r;this.drawCell(e,o.x,o.y,null===(a=this.state.data)||void 0===a||null===(r=a[o.y])||void 0===r?void 0:r[o.x])}else{let t=(o.x+(1&o.y)/2+.5)*this.props.size*Math.sin(2*Math.PI/6)*2*.75,s=(o.y+.5)*this.props.size*.75*2*.75;e.beginPath();for(var l=0;l<6;l++)e.lineTo(t+this.props.size*Math.sin(2*Math.PI/6*l)*.75,s+this.props.size*Math.cos(2*Math.PI/6*l)*.75);e.closePath(),e.fill()}}}createData(e){this.props.model.colour_map.clear_temp();var t=[];for(var[s,i]of e.entries())for(var[a,r]of(t[s]=[],i.entries())){let e=this.props.model.colour_map.find_colour(r);null==e&&(e=this.props.model.colour_map.new_colour(),this.props.model.colour_map.add_temp(r,e)),t[s][a]=[r,e]}return t}updateData(e){var t=this.createData(e);this.setState({data:t})}drawCell(e,t,s,i){let a;if(a="square"===this.props.geometry?new P((t+.5)*this.props.size,(s+.5)*this.props.size):new P((t+(1&s)/2+.5)*this.props.size*Math.sin(2*Math.PI/6)*2*.75,(s+.5)*this.props.size*.75*2*.75),a.x-this.props.size+this.state.offset.x>this.canvas.width/window.devicePixelRatio||a.y-this.props.size+this.state.offset.y>this.canvas.height/window.devicePixelRatio)return!1;if(a.x+this.props.size+this.state.offset.x<0||a.y+this.props.size+this.state.offset.y<0)return!1;if(void 0===i?e.fillStyle="rgba(0,0,0,0)":(e.fillStyle="rgb("+i[1].rgb().join(",")+")",e.strokeStyle=e.fillStyle),"square"===this.props.geometry)void 0===i?e.clearRect(a.x-this.props.size/2,a.y-this.props.size/2,this.props.size,this.props.size):e.fillRect(a.x-this.props.size/2,a.y-this.props.size/2,this.props.size,this.props.size);else if("hex"===this.props.geometry){e.beginPath();for(var r=0;r<6;r++)e.lineTo(a.x+this.props.size*[0,.645,.645,0,-.645,-.645][r],a.y+this.props.size*[.75,.375,-.375,-.75,-.375,.375][r]);e.closePath(),e.strokeStyle=e.fillStyle,e.stroke(),e.fill()}if(this.props.size>=12&&void 0!==i){let[t,s,r]=i[1].rgb();e.fillStyle=.299*t+.587*s+.114*r>186?"black":"white",e.textAlign="center",e.textBaseline="middle",e.font="11px Arial",e.fillText(i[0],a.x,a.y,this.props.size)}return!0}}var M=z,E=s(145),D=s.n(E),I=s(198),T=s.n(I),N=s(80),A=s.n(N),F=s(445),q=s(441),L=s(451),B=s(459),U=s(455),G=s(457),$=s(446),V=s(456),W=s(461),H=s(460);class Y extends a.a.Component{render(){return Object(C.jsx)(O.a,{item:!0,xs:12,sm:8,children:Object(C.jsxs)(L.a,{sx:{height:"100%"},children:[Object(C.jsx)(U.a,{title:"Transition Rules"}),Object(C.jsx)(O.a,{container:!0,item:!0,id:"colour_container",sx:{overflowY:"auto",maxHeight:"20rem"},children:Object(C.jsx)(V.a,{size:"small",children:Object(C.jsx)($.a,{children:this.props.rules.map(((e,t)=>Object(C.jsx)(G.a,{children:Object(C.jsx)(J,{rule:e,deleteRule:()=>this.props.deleteRule(e)},e.toString()+t.toString())})))})})}),Object(C.jsx)(B.a,{children:Object(C.jsx)(F.a,{variant:"outlined",onClick:this.props.addRule,children:" Add Rule "})})]})})}}class J extends a.a.Component{constructor(e){super(e),this.rule=void 0,this.deleteRule=void 0,this.rule=e.rule,this.state={reactant0:e.rule.reactants[0],reactant1:!e.rule.is_mono&&e.rule.reactants.length>1?e.rule.reactants[1]:"",product0:e.rule.products[0],product1:!e.rule.is_mono&&e.rule.products.length>1?e.rule.products[1]:"",rate:e.rule.rate},this.deleteRule=e.deleteRule}render(){return Object(C.jsxs)(H.a,{hover:!0,children:[Object(C.jsxs)(W.a,{children:[" ",Object(C.jsx)(q.a,{variant:"filled",type:"number",value:this.state.rate,onChange:this.updateRule.bind(this),style:{width:"5rem"},inputProps:{inputMode:"numeric",step:.1,pattern:"[0-9]+(\\.[0-9]+)?",className:"rulesRate",min:0,style:{padding:"5px"}}})," "]}),Object(C.jsxs)(W.a,{padding:"none",children:[" ",Object(C.jsx)(q.a,{variant:"filled",value:this.state.reactant0,onChange:this.updateRule.bind(this),inputProps:{className:"rulesReactant0",style:{padding:"5px"}}})," "]}),Object(C.jsxs)(W.a,{padding:"none",align:"center",children:[" ",Object(C.jsx)(D.a,{})," "]}),Object(C.jsxs)(W.a,{padding:"none",align:"center",children:[" ",Object(C.jsx)(q.a,{variant:"filled",value:this.state.reactant1,className:"rulesReactant1",onChange:this.updateRule.bind(this),inputProps:{className:"rulesReactant1",style:{padding:"5px"}}})," "]}),Object(C.jsxs)(W.a,{padding:"none",align:"center",children:[" ",Object(C.jsx)(T.a,{})," "]}),Object(C.jsxs)(W.a,{padding:"none",align:"center",children:[" ",Object(C.jsx)(q.a,{variant:"filled",value:this.state.product0,className:"rulesProduct0",onChange:this.updateRule.bind(this),inputProps:{className:"rulesProduct0",style:{padding:"5px"}}})," "]}),Object(C.jsxs)(W.a,{padding:"none",align:"center",children:[" ",Object(C.jsx)(D.a,{})," "]}),Object(C.jsxs)(W.a,{padding:"none",align:"center",children:[" ",Object(C.jsx)(q.a,{variant:"filled",value:this.state.product1,className:"rulesProduct1",onChange:this.updateRule.bind(this),inputProps:{className:"rulesProduct1",style:{padding:"5px"}}})," "]}),Object(C.jsxs)(W.a,{children:[" ",Object(C.jsxs)(y.a,{onClick:this.deleteRule,children:[" ",Object(C.jsx)(A.a,{})," "]})," "]})]})}updateRule(e){let t=[this.state.reactant0,this.state.reactant1],s=[this.state.product0,this.state.product1],i=e.currentTarget.value;if(e.target.classList.contains("rulesReactant0")){t[0]=i;try{this.rule.update({reactants:t.filter((e=>""!==e))})}catch{}this.setState({reactant0:i})}else if(e.target.classList.contains("rulesReactant1")){t[1]=i;try{this.rule.update({reactants:t.filter((e=>""!==e))})}catch{}this.setState({reactant1:i})}else if(e.target.classList.contains("rulesProduct0")){s[0]=i;try{this.rule.update({products:s.filter((e=>""!==e))})}catch{}this.setState({product0:i})}else if(e.target.classList.contains("rulesProduct1")){s[1]=i;try{this.rule.update({products:s.filter((e=>""!==e))})}catch{}this.setState({product1:i})}else e.target.classList.contains("rulesRate")&&(s[1]=i,this.rule.update({rate:+i}),this.setState({rate:+i}))}}var Z=s(201),K=s(199),Q=s.n(K),X=s(200),ee=s.n(X);class te extends a.a.Component{render(){return Object(C.jsx)(O.a,{item:!0,xs:12,sm:4,children:Object(C.jsxs)(L.a,{sx:{height:"100%"},children:[Object(C.jsx)(U.a,{title:"Colour Mapping"}),Object(C.jsx)(O.a,{container:!0,item:!0,sx:{overflowY:"auto",maxHeight:"28rem",height:"100%"},children:Object(C.jsx)($.a,{children:[...this.props.colour_map.colours.values()].map(((e,t)=>Object(C.jsx)(G.a,{children:Object(C.jsx)(se,{colour:e,onChange:this.props.refreshColour,deleteColour:this.props.deleteColour})})))})}),Object(C.jsx)(B.a,{children:Object(C.jsx)(F.a,{variant:"outlined",onClick:this.props.addColour.bind(this),children:" Add Colour "})})]})})}}class se extends a.a.Component{constructor(e){super(e),this.pickerRef=null,this.mouseDownInElement=!1,this.state={colour:e.colour.hex(),isOpen:!1,species:e.colour.species,name:e.colour.name,showList:!1},this.handleClickOutside=this.handleClickOutside.bind(this)}handleClickOutside(e){this.mouseDownInElement||!this.pickerRef||this.pickerRef.contains(e.target)||this.setState({isOpen:!1})}handleDownClick(e){this.mouseDownInElement=!this.pickerRef||this.pickerRef.contains(e.target)}componentDidMount(){document.addEventListener("mousedown",this.handleDownClick.bind(this)),document.addEventListener("mouseup",this.handleClickOutside.bind(this))}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDownClick),document.removeEventListener("mouseup",this.handleClickOutside)}render(){return Object(C.jsxs)(O.a,{item:!0,xs:12,children:[Object(C.jsxs)("div",{className:"picker",children:[Object(C.jsx)("div",{className:"swatch",style:{backgroundColor:this.props.colour.hex()},onClick:()=>!this.state.isOpen&&this.setState({isOpen:!this.state.isOpen})}),Object(C.jsx)(q.a,{variant:"filled",fullWidth:!0,margin:"none",label:"Name",value:this.state.name,onChange:e=>{let t=e.currentTarget.value;this.setState({name:t}),this.props.colour.name=t}}),Object(C.jsx)(y.a,{onClick:e=>this.setState({showList:!this.state.showList}),children:this.state.showList?Object(C.jsx)(Q.a,{}):Object(C.jsx)(ee.a,{})}),Object(C.jsx)(y.a,{onClick:e=>this.props.deleteColour(this.props.colour),children:Object(C.jsx)(A.a,{})})]}),this.state.isOpen&&Object(C.jsx)("div",{className:"popover",ref:e=>this.pickerRef=e,children:Object(C.jsx)(Z.a,{color:this.props.colour.hex(),onChange:e=>{this.setState({colour:e}),this.updateColour(e)}})}),Object(C.jsx)($.a,{children:this.state.showList&&Object(C.jsxs)(G.a,{children:[Object(C.jsx)($.a,{children:[...this.state.species.values()].map((e=>Object(C.jsxs)(G.a,{children:[Object(C.jsx)(q.a,{value:e.original_string,onChange:this.updateSpecies(e).bind(this),inputProps:{style:{padding:"5px"}}}),Object(C.jsxs)(y.a,{onClick:()=>this.deleteMatcher(e),children:[" ",Object(C.jsx)(A.a,{})," "]})]})))}),Object(C.jsx)(F.a,{variant:"outlined",onClick:this.addMatcher.bind(this),children:" Add Species "})]})})]})}updateColour(e){this.props.colour.update_colour(n.Colour.hex2rgb(e)),this.props.onChange()}updateSpecies(e){return t=>{e.update_matched(t.target.value),this.setState({species:this.props.colour.species}),this.props.onChange()}}addMatcher(){this.props.colour.add_matcher(""),this.setState({species:this.props.colour.species})}deleteMatcher(e){this.props.colour.delete_matcher(e),this.setState({species:this.props.colour.species})}}var ie=s(442),ae=s(462),re=s(437),le=s(439);class ne extends a.a.Component{constructor(e){super(e),this.state={example_selected:""}}render(){return Object(C.jsx)(O.a,{item:!0,xs:12,sm:4,children:Object(C.jsxs)(L.a,{sx:{height:"100%"},children:[Object(C.jsx)(U.a,{title:"Import/Export"}),Object(C.jsxs)(O.a,{container:!0,children:[Object(C.jsx)(O.a,{item:!0,xs:12,sm:8,children:Object(C.jsxs)(ae.a,{fullWidth:!0,children:[Object(C.jsx)(ie.a,{id:"example-label",children:"Example"}),Object(C.jsx)(re.a,{label:"example-label",value:this.state.example_selected,onChange:e=>this.setState({example_selected:e.target.value}),autoWidth:!0,children:[{value:"./examples/two-bit-adder.txt",label:"Two Bit Adder"},{value:"./examples/two-bit-adder_new.txt",label:"Two Bit Adder New"},{value:"./examples/alternate_line_builder.txt",label:"Line Builder"},{value:"./examples/Brusselator.txt",label:"Brusselator"},{value:"./examples/busy_beaver.txt",label:"Busy Beaver"},{value:"./examples/ertl.txt",label:"Ertl Oscillator"},{value:"./examples/game_of_life_5x5_circuit.txt",label:"GoL Five by Five"},{value:"./examples/game_of_life_one_to_one.txt",label:"GoL One to One"},{value:"./examples/GH_big_spiral.txt",label:"Greenberg-Hastings Big spiral"},{value:"./examples/majority_asynchronous.txt",label:"Majority Asynchronous"},{value:"./examples/molecular_walker.txt",label:"Molecular Walker"},{value:"./examples/parens_matcher.txt",label:"Parens Matcher"},{value:"./examples/sierpinski_1D_synch.txt",label:"1D Sierpinski"},{value:"./examples/smarter_scout_ant.txt",label:"Smarter Scout Ant"}].map((e=>Object(C.jsxs)(le.a,{value:e.value,children:[" ",e.label," "]})))})]})}),Object(C.jsx)(O.a,{item:!0,xs:12,sm:4,children:Object(C.jsx)(F.a,{variant:"contained",disabled:""===this.state.example_selected,type:"submit",id:"import_example",onClick:()=>this.props.import_example(this.state.example_selected),children:" Import "})})]}),Object(C.jsxs)(B.a,{children:[Object(C.jsxs)(F.a,{variant:"contained",component:"label",children:["Import File(s)",Object(C.jsx)("input",{type:"file",id:"import_input",multiple:!0,hidden:!0,onChange:this.props.import_code})]}),Object(C.jsx)(F.a,{variant:"contained",id:"export",onClick:this.props.export_code,children:" Export File "})]})]})})}}var oe=ne,he=(s(381),s(382),s(383),s(384),s(436)),ce=s(438),de=s(452),ue=s(453),pe=s(454),me=s(202),_e=s.n(me),fe=s(203),xe=s.n(fe),be=s(204),je=s(448);const ge=Object(be.a)({palette:{mode:"dark",primary:{main:"#2e7d32"},secondary:{main:"#f50057"}}});class ve extends a.a.Component{constructor(e){super(e),this.initial_state_component=null,this.transition_state_component=null,this.simulator_component=null,this.header_component=null,this.model_tabs=null,this.toolbarInput=null;let t=new o.a({geometry:"square",initial_state:Array.from({length:20},(()=>Array.from({length:20},(()=>"I"))))});this.state={shown_tab:0,model:t,sim_size:t.pixels_per_node,geometry:t.geometry,colour_map:t.colour_map,rules:t.rules,playing_simulation:!1,editValue:"",selectedCells:[],rngSeed:(t.rng_seed||"").toString(),fps:t.fps,speedup_factor:t.speedup_factor}}render(){var e;return Object(C.jsxs)(je.a,{theme:ge,children:[Object(C.jsx)(he.a,{}),Object(C.jsxs)(O.a,{container:!0,spacing:1,sx:{margin:"auto",width:"98%",height:"98%"},children:[Object(C.jsx)(k,{playPressed:this.playPressed.bind(this),stepBackPressed:this.stepBackwardPressed.bind(this),stepForwardPressed:this.stepForwardPressed.bind(this),fastBackwardPressed:this.fastBackwardPressed.bind(this),fastForwardPressed:this.fastForwardPressed.bind(this),stopPressed:this.stopPressed.bind(this),simPlaying:this.state.playing_simulation,ref:e=>this.header_component=e}),Object(C.jsx)(O.a,{item:!0,xs:12,sm:8,children:Object(C.jsx)(L.a,{sx:{height:"35rem"},children:Object(C.jsxs)(O.a,{container:!0,sx:{height:"100%"},children:[Object(C.jsxs)(O.a,{item:!0,xs:12,sx:{height:"20%"},children:[Object(C.jsxs)(ce.a,{value:this.state.shown_tab,onChange:this.onTabSelect.bind(this),children:[Object(C.jsx)(de.a,{label:"Initial State"}),Object(C.jsx)(de.a,{label:"Simulator"})]}),Object(C.jsxs)(ue.a,{style:{display:"inline"},children:[0===this.state.shown_tab&&Object(C.jsxs)(ue.a,{children:[Object(C.jsx)(S.a,{variant:"overline",sx:{fontSize:20,margin:"5px"},children:" Editing Options "}),Object(C.jsx)(q.a,{label:"",size:"small",variant:"filled",value:this.state.editValue,onChange:this.updateSelectedCells.bind(this),inputRef:e=>this.toolbarInput=e}),Object(C.jsx)(y.a,{"aria-label":"Type",onClick:this.changeGeometry.bind(this),children:"hex"===this.state.model.geometry?Object(C.jsx)(_e.a,{}):Object(C.jsx)(xe.a,{})}),Object(C.jsx)(q.a,{label:"Random Seed",value:this.state.rngSeed,onChange:this.setRNGseed.bind(this),size:"small"})]}),1===this.state.shown_tab&&Object(C.jsxs)(ue.a,{children:[Object(C.jsx)(S.a,{variant:"overline",sx:{fontSize:20,margin:"5px"},children:" Playback Options "}),Object(C.jsx)(q.a,{label:"Speed",size:"small",variant:"filled",value:this.state.speedup_factor,onChange:this.updateSpeedUp.bind(this),InputProps:{type:"number"},style:{width:"10%"}}),Object(C.jsx)(q.a,{label:"FPS",size:"small",variant:"filled",value:this.state.fps,onChange:this.updateFPS.bind(this),InputProps:{type:"number"},style:{width:"10%"}}),Object(C.jsx)(q.a,{label:"Random Seed",value:1===this.state.shown_tab?null===(e=this.state.model.random)||void 0===e?void 0:e.seed.toString():this.state.rngSeed,onChange:this.setRNGseed.bind(this),disabled:1===this.state.shown_tab,InputProps:{endAdornment:1===this.state.shown_tab?Object(C.jsx)(pe.a,{position:"end",children:Object(C.jsx)(F.a,{onClick:this.copyRNGseed.bind(this),children:"Set"})}):null},size:"small"})]})]})]}),Object(C.jsxs)(O.a,{item:!0,xs:12,sx:{height:"80%"},children:[0===this.state.shown_tab&&Object(C.jsx)(M,{current_state:this.state.model.initial_state,model:this.state.model,geometry:this.state.geometry,ref:e=>this.initial_state_component=e,size:this.state.sim_size,zoom:this.zoom.bind(this),selectedCells:this.selectedCells.bind(this)}),1===this.state.shown_tab&&Object(C.jsx)(M,{current_state:this.state.model.sim_started()?this.state.model.current_state:this.state.model.initial_state,model:this.state.model,geometry:this.state.geometry,ref:e=>this.simulator_component=e,size:this.state.sim_size,zoom:this.zoom.bind(this),selectedCells:this.selectedCells.bind(this),simulation:!0})]})]})})}),Object(C.jsx)(te,{model:this.state.model,refreshColour:this.refreshColour.bind(this),addColour:this.addColour.bind(this),deleteColour:this.deleteColour.bind(this),colour_map:this.state.colour_map}),Object(C.jsx)(Y,{ref:e=>this.transition_state_component=e,model:this.state.model,addRule:this.addRule.bind(this),deleteRule:this.deleteRule.bind(this),rules:this.state.rules}),Object(C.jsx)(oe,{export_code:this.export_code.bind(this),import_code:this.import_code.bind(this),import_example:this.import_example.bind(this)})]})]})}async import_code(){const e=document.getElementById("import_input").files;if(null===e)return;let t=await o.a.parser.parse_import_files([...e]);!1===t||this.update_page(t)}export_code(){let e=this.state.model.export(),t=new Blob([e],{type:"text/plain"}),s=document.createElement("a");s.download="surface_crn_export.txt",s.href=(window.webkitURL||window.URL).createObjectURL(t),s.dataset.downloadurl=["text/plain",s.download,s.href].join(":"),s.click()}import_example(e){if(""===e)return;let t=this;fetch(e,{headers:{"Content-Type":"application/text",Accept:"application/text"}}).then((function(e){return e.text()})).then((function(e){let s=o.a.parser.parse_code(e.split("\n"));t.update_page(s)}))}setPlaying(e){this.setState({playing_simulation:e})}update_page(e){this.setState({shown_tab:0,playing_simulation:!1,model:e,geometry:e.geometry,sim_size:e.pixels_per_node,colour_map:e.colour_map,rules:[...e.rules],editValue:"",selectedCells:[],rngSeed:(e.rng_seed||"").toString(),fps:e.fps,speedup_factor:e.speedup_factor})}changeGeometry(){"hex"===this.state.model.geometry?this.state.model.geometry="square":"square"===this.state.model.geometry&&(this.state.model.geometry="hex"),this.setState({geometry:this.state.model.geometry}),this.refreshSimState(),this.refreshInitState()}refreshInitState(){null!==this.initial_state_component&&this.initial_state_component.setState({colour_map:this.state.model.colour_map,geometry:this.state.model.geometry,size:this.state.model.pixels_per_node,data:this.initial_state_component.createData(this.state.model.initial_state)})}refreshSimState(){const e=this.simulator_component,t=this.state.model;null!==e&&e.setState({colour_map:t.colour_map,size:t.pixels_per_node,data:e.createData(t.sim_started()?t.current_state:t.initial_state),sim_time:t.sim_time})}refreshColour(){this.refreshInitState(),this.refreshSimState()}startSimulation(){this.state.model.start_sim(),this.refreshSimState(),this.setState({rngSeed:this.state.model.random.seed.toString()})}showSimulation(){1!==this.state.shown_tab&&this.setState({shown_tab:1}),this.state.model.sim_started()||this.startSimulation()}onTabSelect(e,t){this.setState({shown_tab:t}),1===t&&this.startSimulation()}playPressed(e){e.preventDefault(),this.showSimulation(),this.state.playing_simulation?this.setPlaying(!1):(this.setPlaying(!0),this.playSimulation(!0))}playSimulation(e){if(!e&&!this.state.playing_simulation)return;let t=this.state.model.next_frame();this.refreshSimState(),t?window.setTimeout(this.playSimulation.bind(this),1/this.state.model.fps):this.setPlaying(!1)}stepForwardPressed(e){e.preventDefault(),this.showSimulation(),this.state.model.step_forward(),this.refreshSimState()}stepBackwardPressed(e){e.preventDefault(),this.showSimulation(),this.state.model.step_backward(),this.refreshSimState()}fastForwardPressed(e){e.preventDefault(),this.showSimulation(),this.state.model.next_frame(),this.refreshSimState()}fastBackwardPressed(e){e.preventDefault(),this.showSimulation(),this.state.model.prev_frame(),this.refreshSimState()}stopPressed(e){e.preventDefault(),this.setPlaying(!1),this.state.model.stop_sim(),this.refreshSimState()}addColour(){let e=this.state.model.colour_map.new_colour();this.state.model.colour_map.add(Object.assign(e,{name:"New"})),this.setState({colour_map:this.state.model.colour_map})}deleteColour(e){this.state.model.colour_map.delete(e),this.setState({colour_map:this.state.model.colour_map})}deleteRule(e){this.state.model.remove_rule(e),this.setState({rules:[...this.state.model.rules]})}addRule(){this.state.model.add_rule(),this.setState({rules:[...this.state.model.rules]})}zoom(e){const t=this.state.model.pixels_per_node;return e?this.state.model.increase_size():this.state.model.decrease_size(),this.setState({sim_size:this.state.model.pixels_per_node}),t/this.state.model.pixels_per_node}selectedCells(e,t){this.setState({selectedCells:e,editValue:t}),this.toolbarInput&&this.toolbarInput.focus()}updateSelectedCells(e){e.target.value.match(/^\w*$/)&&(this.setState({editValue:e.target.value}),this.state.model.set_cells(this.state.selectedCells.map((e=>[e.x,e.y])),e.target.value),this.refreshInitState())}setRNGseed(e){let t=e.target.value;if(""===t)this.setState({rngSeed:t}),this.state.model.rng_seed=null;else{let e=parseInt(t);this.setState({rngSeed:t}),this.state.model.rng_seed=e}}copyRNGseed(){this.state.model.rng_seed=this.state.model.random.seed,this.setState({rngSeed:this.state.model.rng_seed.toString()})}updateFPS(e){let t=e.target.value,s=parseFloat(t);this.setState({fps:s}),this.state.model.fps=s}updateSpeedUp(e){let t=e.target.value,s=parseFloat(t);this.setState({speedup_factor:s}),this.state.model.speedup_factor=s}}l.a.render(Object(C.jsxs)(a.a.StrictMode,{children:[Object(C.jsx)("title",{children:" Surface CRN Simulator "}),Object(C.jsx)(ve,{})]}),document.getElementById("root"))},58:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Colour=t.Colour_Map=t.Transition_Rule=t.Species_Matcher=void 0;const a=i(s(114));t.Species_Matcher=a.default;const r=i(s(188));t.Transition_Rule=r.default;const l=i(s(368));t.Colour_Map=l.default;const n=i(s(135));t.Colour=n.default;const o=i(s(369)),h=s(370),c=i(s(371)),d=s(385);class u{constructor(e={}){this.initial_state=[],this.rules=[],this.colour_map=new l.default,this.options=new Map,this.geometry="square",this.rng_seed=null,this.pixels_per_node=20,this.speedup_factor=1,this.fps=30,this.random=null,this.current_state=[],this.last_updated=[],this.sim_time=0,this.sim_queue=null,this.sim_history=[],this.rule_check_cache={},Object.assign(this,e)}remove_rule(e){this.rules.splice(this.rules.indexOf(e),1)}add_rule(){this.rules.push(r.default.blankRule())}set_cells(e,t){if(0===e.length)return;let s=e.map((e=>e[0])).sort(),i=s[0],a=s[s.length-1];if(i<0){for(let e of this.initial_state)e.unshift(...Array(-i).fill(""));a-=i}let r=this.initial_state[0].length;if(a>=r)for(let h of this.initial_state)h.push(...Array(a-r+1).fill(""));let l=e.map((e=>e[1])).sort(),n=l[0],o=l[l.length-1];n<0&&(this.initial_state.unshift(...Array(-n).map((e=>Array(this.initial_state[0].length).fill("")))),o-=n),o>=this.initial_state.length&&this.initial_state.push(...Array(o-this.initial_state.length+1).fill("").map((e=>Array(this.initial_state[0].length).fill(""))));for(let[h,c]of e)this.initial_state[c][h]=t}set_option(e,t){switch(e){case"geometry":if("square"!==t&&"hex"!==t)throw"Invalid option: Geometry";this.geometry=t;break;case"rng_seed":var s=parseInt(t);this.rng_seed=s;break;case"pixels_per_node":s=parseFloat(t);this.pixels_per_node=s;break;case"speedup_factor":s=parseFloat(t);this.speedup_factor=s;break;case"fps":s=parseFloat(t);this.fps=s}this.options.set(e,t)}export(){let e=[];for(let[t,s]of this.options)e.push(t+" = "+s);return e.push("!START_TRANSITION_RULES"),e.push(...this.rules.map((e=>e.toString()))),e.push("!END_TRANSITION_RULES\n"),e.push(["!START_COLORMAP"]),e.push(...this.colour_map.export()),e.push(["!END_COLORMAP\n"]),e.push(["!START_INIT_STATE"]),e.push(...this.initial_state.map((e=>e.join(" ")))),e.push(["!END_INIT_STATE\n"]),e.join("\n")}stop_sim(){this.current_state=[],this.last_updated=[],this.sim_time=0,this.sim_queue=null,this.sim_history=[],this.rule_check_cache={},this.colour_map.clear_temp()}start_sim(){if(this.sim_started())return;null!==this.rng_seed?this.random=new d.MersenneTwister(this.rng_seed):(this.random=new d.MersenneTwister,this.random=new d.MersenneTwister(this.random.int())),this.sim_queue=new c.default({comparator:(e,t)=>e.execution_time-t.execution_time});let e=[];this.initial_state.forEach(((t,s)=>{this.last_updated.push(Array(t.length).fill(0)),this.current_state.push([]),t.forEach(((t,i)=>{this.current_state[this.current_state.length-1].push(this.initial_state[s][i]);let a=this.find_next_transitions(i,s);for(let s of a)e.push(s)}))})),this.sim_queue=new c.default({comparator:(e,t)=>e.execution_time-t.execution_time,initialValues:e})}get_next_transition(){if(this.sim_started()){for(;0!=this.sim_queue.length;){let e=this.sim_queue.peek();if(e.new_cells.every((([t,s,i])=>this.last_updated[s][t]<=e.update_time)))break;this.sim_queue.dequeue()}return 0!=this.sim_queue.length&&this.sim_queue.peek()}return!1}run_upto(e){for(;this.sim_time<e;){let t=this.get_next_transition();if(!1===t)return!1;if(t.execution_time>e)break;this.step_forward()}return this.sim_time=e,!0}run_backto(e){for(;this.sim_time>e;){if(!1===this.step_backward())return!1}return this.sim_time=e,!0}next_frame(){return this.run_upto(this.sim_time+1*this.speedup_factor/this.fps)}prev_frame(){return this.run_backto(this.sim_time-1*this.speedup_factor/this.fps)}step_forward(){if(this.sim_started()){let e=this.get_next_transition();if(!1===e)return!1;if(this.sim_queue.dequeue(),this.sim_time=e.execution_time,e.new_cells.forEach((([e,t,s])=>{this.current_state[t][e]=s,this.last_updated[t][e]=this.sim_time})),null===e.new_transitions){e.new_transitions=[];let t=new Set;e.new_cells.forEach((([s,i,a])=>{let r=this.find_next_transitions(s,i,t);for(var l of r)this.sim_queue.queue(l),e&&e.new_transitions.push(l);t.add([s,i])}))}else e.new_transitions.forEach((e=>{this.sim_queue.queue(e)}));return this.sim_history.push(e),0!=this.sim_queue.length}return!1}step_backward(){if(this.sim_started()){let e=this.sim_history.pop();return void 0!==e&&(this.sim_time=e.execution_time,e.old_cells.forEach((([e,t,s])=>{this.current_state[t][e]=s,this.last_updated[t][e]=0})),this.sim_queue.queue(e),!0)}return!1}find_next_transitions(e,t,s=new Set){let i=this.current_state[t][e],a=[],r=[],l=this.rule_check_cache[i];r=void 0===l?this.rules:l;for(let n of r)if(n.is_mono){let s=n.matches(i);for(const r of s){let s=this.sim_time+Math.log(1/this.random.float())/n.rate,l=new o.default(this.sim_time,s);l.add_old_cell(e,t,i),l.add_new_cell(e,t,r[0]),a.push(l)}}else{let r=[];r="square"==this.geometry?[[-1,0],[0,-1],[1,0],[0,1]]:[[1,0],[-1,0],[0,1],[t%2?1:-1,1],[0,-1],[t%2?1:-1,-1]];for(let[l,h]of r)if(t+h>=0&&t+h<this.current_state.length&&e+l>=0&&e+l<this.current_state[t+h].length){if(s.has([e+l,t+h]))continue;let r=this.current_state[t+h][e+l],c=n.matches(i,r);for(const s of c){let c=this.sim_time+Math.log(1/this.random.float())/n.rate,d=new o.default(this.sim_time,c);d.add_old_cell(e,t,i),d.add_old_cell(e+l,t+h,r),d.add_new_cell(e,t,s[0]),d.add_new_cell(e+l,t+h,s[1]),a.push(d)}c=n.matches(r,i);for(const s of c){let c=this.sim_time+Math.log(1/this.random.float())/n.rate,d=new o.default(this.sim_time,c);d.add_old_cell(e,t,i),d.add_old_cell(e+l,t+h,r),d.add_new_cell(e,t,s[1]),d.add_new_cell(e+l,t+h,s[0]),a.push(d)}}}return a}sim_started(){return null!==this.sim_queue}increase_size(){this.pixels_per_node<1?this.pixels_per_node=1/(1/this.pixels_per_node-1):this.pixels_per_node+=1}decrease_size(){this.pixels_per_node<=1?this.pixels_per_node=1/(1/this.pixels_per_node+1):this.pixels_per_node-=1}}t.default=u,u.parser={parse_import_files:h.parse_import_files,parse_code:h.parse_code}}},[[386,1,2]]]);
//# sourceMappingURL=main.3922814c.chunk.js.map