(this.webpackJsonpsurface_crn_ide=this.webpackJsonpsurface_crn_ide||[]).push([[0],{135:function(e,t,s){"use strict";s.r(t);var i=s(0),n=s.n(i),a=s(24),r=s.n(a),o=s(30),l=s.n(o),u=s(12),c=s(58),h=s(2),d=s(3),p=s(5),m=s(4),f=s(14),_=(s(70),s(7)),v=s.n(_),b=(s(92),s(6)),j=s(1),x=function(e){Object(p.a)(s,e);var t=Object(m.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).state={simPlaying:!1},i}return Object(d.a)(s,[{key:"render",value:function(){return Object(j.jsx)("header",{className:"grid",children:Object(j.jsxs)("nav",{className:"grid",children:[Object(j.jsx)("h2",{className:"grid title",children:"Surface CRN Simulator"}),Object(j.jsx)("h4",{className:"grid simulator_options"}),Object(j.jsxs)("h4",{className:"simulator_controls",children:[Object(j.jsx)(b.k,{size:25,onClick:this.props.stopPressed}),Object(j.jsx)(b.c,{size:25,onClick:this.props.fastBackwardPressed}),Object(j.jsx)(b.i,{size:25,onClick:this.props.stepBackPressed}),this.state.simPlaying?Object(j.jsx)(b.f,{size:25,onClick:this.props.playPressed}):Object(j.jsx)(b.g,{size:25,onClick:this.props.playPressed}),Object(j.jsx)(b.j,{size:25,onClick:this.props.stepForwardPressed}),Object(j.jsx)(b.d,{size:25,onClick:this.props.fastForwardPressed})]})]})})}}]),s}(n.a.Component),y=s(62),g=s(18),k=function(){function e(t,s){Object(h.a)(this,e),this.x=void 0,this.y=void 0,this.x=t,this.y=s}return Object(d.a)(e,[{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"subtract",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"scale",value:function(t){return new e(this.x*t,this.y*t)}}]),e}();k.origin=new k(0,0);var O=k,w=s(33),S=function(e){Object(p.a)(s,e);var t=Object(m.a)(s);function s(e){var i;Object(h.a)(this,s),(i=t.call(this,e)).onAutofill=function(e,t){var s=Object(w.repeatSelectionIntoFill)(e,t,i.state.data,i.state.columns,i.autofillCell);i.setState({data:s})},i.onCellDataChanged=function(e){i.props.update_state(e.rowIndex-1,e.colIndex-1,e.newData)};var n=e.current_state,a=e.colour_map,r=e.geometry;return i.state={columns:i.createCols(n,e.size),data:i.createData(n),colour_map:a,geometry:r,offset:O.origin,size:e.size},i}return Object(d.a)(s,[{key:"render",value:function(){return Object(j.jsx)(w.ReactCanvasGrid,{columns:this.state.columns,data:this.state.data,rowHeight:this.state.size,onCellDataChanged:this.onCellDataChanged,shouldAllowAutofill:function(e){return!0},onAutofill:this.onAutofill})}},{key:"autofillCell",value:function(e){return Object(g.a)(Object(g.a)({},e.destCellDef),{},{data:e.srcCellDef.data})}},{key:"updateColsAndData",value:function(e){this.setState({columns:this.createCols(e),data:this.createData(e)})}},{key:"createCols",value:function(e,t){var s=[],i=0;0!==e.length&&(i=e[0].length),s.push({fieldName:"addLeftCol",width:t||this.state.size});for(var n=0;n<i;n++)s.push({fieldName:n.toString(),width:t||this.state.size});return s.push({fieldName:"addRightCol",width:t||this.state.size}),s}},{key:"createData",value:function(e){for(var t=this,s=[],i=-1;i<=e.length;i++){var n={};if(-1!==i&&i!==e.length)for(var a=0;a<e[0].length;a++)n[a.toString()]={data:e[i][a],getText:function(e){return e||""},renderBackground:function(e,s,i,n){if(null!==i.data){var a=t.state.colour_map.find_colour(i.data);if(null==a){var r=t.state.colour_map.new_colour();a=new _.Colour(r),t.state.colour_map.add_temp(i.data,a)}e.fillStyle="rgb("+a.rgb().join(",")+")",e.fillRect(s.left,s.top,s.width,s.height)}},renderText:function(e,s,i){if(t.state.size>=10){var n=Object(w.cellHasTextFunction)(i)?i.getText(i.data):i.text;if(n){var a=t.state.colour_map.find_colour(i.data);if(null==a){var r=t.state.colour_map.new_colour();a=new _.Colour(r),t.state.colour_map.add_temp(i.data,a),console.log(i.data,a)}var o=a.rgb(),l=Object(y.a)(o,3),u=l[0],c=l[1],h=l[2];e.fillStyle=.299*u+.587*c+.114*h>186?"black":"white",e.fillText(n,s.left+2,s.top+10,s.width-4)}}},editor:{serialise:function(e){return e||""},deserialise:function(e,t){return(e=e.trim()).match(/^\w+$/)?e:t}}};else if(0!=e.length)for(var r=0;r<e[0].length;r++)n[r.toString()]={data:null,text:"",renderBackground:function(){return 1}};n.addLeftCol={data:null,text:"",renderBackground:function(){return 1}},n.addRightCol={data:null,text:"",renderBackground:function(){return 1}},s.push(n)}return s}}]),s}(n.a.Component),C=function(e){Object(p.a)(s,e);var t=Object(m.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).state={rules_list:e.model.rules},i}return Object(d.a)(s,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{className:"grid panel rules_panel",children:[Object(j.jsx)("h3",{className:"panel_header",children:" Transition Rules "}),Object(j.jsxs)("div",{id:"rule_container",children:[this.state.rules_list.map((function(t,s){return Object(j.jsx)(R,{rule:t,deleteRule:function(){return e.props.deleteRule(t)}},t.toString()+s.toString())})),Object(j.jsx)("div",{onClick:this.props.addRule,children:" Add Rule "})]})]})}}]),s}(n.a.Component),R=function(e){Object(p.a)(s,e);var t=Object(m.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).rule=void 0,i.deleteRule=void 0,i.rule=e.rule,i.state={reactant0:e.rule.reactants[0].original_string,reactant1:!e.rule.is_mono&&e.rule.reactants.length>1?e.rule.reactants[1].original_string:"",product0:e.rule.products[0].original_string,product1:!e.rule.is_mono&&e.rule.products.length>1?e.rule.products[1].original_string:"",rate:e.rule.rate},i.deleteRule=e.deleteRule,i}return Object(d.a)(s,[{key:"render",value:function(){return Object(j.jsxs)("div",{className:"rulesRow grid",children:[Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:this.state.rate,type:"number",className:"rulesRate",onChange:this.updateRule.bind(this),min:"0",step:"0.1"})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:this.state.reactant0,className:"rulesReactant0",onChange:this.updateRule.bind(this)})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)(b.h,{})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:this.state.reactant1,className:"rulesReactant1",onChange:this.updateRule.bind(this)})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)(b.b,{})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:this.state.product0,className:"rulesProduct0",onChange:this.updateRule.bind(this)})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)(b.h,{})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:this.state.product1,className:"rulesProduct1",onChange:this.updateRule.bind(this)})," "]}),Object(j.jsx)(b.l,{onClick:this.deleteRule})]})}},{key:"updateRule",value:function(e){var t=this.rule.reactants,s=this.rule.products,i=e.currentTarget.value;switch(e.target.className){case"rulesReactant0":t[0]=new _.Species_Matcher(i),this.rule.update({reactants:t}),this.setState({reactant0:i});break;case"rulesReactant1":t[1]=new _.Species_Matcher(i),this.rule.update({reactants:t}),this.setState({reactant1:i});break;case"rulesProduct0":s[0]=new _.Species_Matcher(i),this.rule.update({products:s}),this.setState({product0:i});break;case"rulesProduct1":s[1]=new _.Species_Matcher(i),this.rule.update({products:s}),this.setState({product1:i});break;case"rulesRate":s[1]=new _.Species_Matcher(i),this.rule.update({rate:+i}),this.setState({rate:+i})}}}]),s}(n.a.Component),P=s(32),I=s(60),N=function(e){Object(p.a)(s,e);var t=Object(m.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).state={colours:i.props.model.colour_map.colours},i}return Object(d.a)(s,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{className:"grid panel colour_panel",children:[Object(j.jsx)("h3",{children:" Colour Mapping "}),Object(j.jsxs)("div",{id:"colour_container",children:[Object(u.a)(this.state.colours.values()).map((function(t){return Object(j.jsx)(T,{colour:t,onChange:e.props.refreshColour},t.name)})),Object(j.jsx)("div",{onClick:this.props.addColour.bind(this),style:{cursor:"pointer"},children:" Add Colour "})]})]})}}]),s}(n.a.Component),T=function(e){Object(p.a)(s,e);var t=Object(m.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).pickerRef=null,i.mouseDownInElement=!1,i.state={colour:e.colour.hex(),isOpen:!1,species:e.colour.species,name:e.colour.name,showList:!1},i.handleClickOutside=i.handleClickOutside.bind(Object(P.a)(i)),i}return Object(d.a)(s,[{key:"handleClickOutside",value:function(e){this.mouseDownInElement||!this.pickerRef||this.pickerRef.contains(e.target)||this.setState({isOpen:!1})}},{key:"handleDownClick",value:function(e){this.mouseDownInElement=!this.pickerRef||this.pickerRef.contains(e.target)}},{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handleDownClick.bind(this)),document.addEventListener("mouseup",this.handleClickOutside.bind(this))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleDownClick),document.removeEventListener("mouseup",this.handleClickOutside)}},{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{children:[Object(j.jsxs)("div",{className:"picker",children:[Object(j.jsx)("div",{className:"swatch",style:{backgroundColor:this.props.colour.hex()},onClick:function(){return!e.state.isOpen&&e.setState({isOpen:!e.state.isOpen})}}),Object(j.jsx)("input",{value:this.state.name,onChange:function(t){var s=t.currentTarget.value;e.setState({name:s}),e.props.colour.name=s}}),Object(j.jsx)(b.a,{size:25,style:{cursor:"pointer"},onClick:function(t){e.setState({showList:!e.state.showList})}})]}),this.state.isOpen&&Object(j.jsx)("div",{className:"popover",ref:function(t){return e.pickerRef=t},children:Object(j.jsx)(I.a,{color:this.props.colour.hex(),onChange:function(t){e.setState({colour:t}),e.updateColour(t)}})}),this.state.showList&&Object(j.jsxs)("div",{className:"flexBox",children:[Object(u.a)(this.state.species.values()).map((function(t){return Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:t.original_string,className:"",onChange:e.updateSpecies(t).bind(e)})," ",Object(j.jsx)(b.l,{onClick:function(){return e.deleteMatcher(t)}})]})})),Object(j.jsx)("div",{style:{cursor:"pointer"},onClick:this.addMatcher.bind(this),children:" Add Species "}),Object(j.jsx)("hr",{})]})]})}},{key:"updateColour",value:function(e){this.props.colour.update_colour(_.Colour.hex2rgb(e)),this.props.onChange()}},{key:"updateSpecies",value:function(e){var t=this;return function(s){e.update_matched(s.target.value),t.setState({species:t.props.colour.species}),t.props.onChange()}}},{key:"addMatcher",value:function(){this.props.colour.add_matcher(""),this.setState({species:this.props.colour.species})}},{key:"deleteMatcher",value:function(e){this.props.colour.delete_matcher(e),this.setState({species:this.props.colour.species})}}]),s}(n.a.Component),M=s(61),A=function(e){Object(p.a)(s,e);var t=Object(m.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).state={example_selected:""},i}return Object(d.a)(s,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{className:"grid panel import_export_panel",children:[Object(j.jsx)("h3",{children:" Import/Export "}),Object(j.jsxs)("div",{children:[Object(j.jsx)(M.a,{options:[{value:"./examples/two-bit-adder.txt",label:"Two Bit Adder"},{value:"./examples/alternate_line_builder.txt",label:"Line Builder"},{value:"./examples/Brusselator.txt",label:"Brusselator"},{value:"./examples/busy_beaver.txt",label:"Busy Beaver"},{value:"./examples/ertl.txt",label:"Ertl Oscillator"},{value:"./examples/game_of_life_5x5_circuit.txt",label:"GoL Five by Five"},{value:"./examples/game_of_life_one_to_one.txt",label:"GoL One to One"},{value:"./examples/GH_big_spiral.txt",label:"Greenberg-Hastings Big spiral"},{value:"./examples/majority_asynchronous.txt",label:"Majority Asynchronous"},{value:"./examples/molecular_walker.txt",label:"Molecular Walker"},{value:"./examples/parens_matcher.txt",label:"Parens Matcher"},{value:"./examples/sierpinski_1D_synch.txt",label:"1D Sierpinski"},{value:"./examples/smarter_scout_ant.txt",label:"Smarter Scout Ant"}],isSearchable:!0,isClearable:!0,onChange:function(t,s){return e.setState({example_selected:t&&t.value})},styles:{option:function(e,t){return Object(g.a)(Object(g.a)({},e),{},{color:"black"})}}}),Object(j.jsx)("button",{disabled:""===this.state.example_selected,type:"submit",id:"import_example",onClick:function(){return e.props.import_example(e.state.example_selected)},children:" Import Example "})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("input",{type:"file",id:"import_input",multiple:!0}),Object(j.jsx)("button",{type:"submit",id:"import_submit",onClick:this.props.import_code,children:" Import "})]}),Object(j.jsx)("div",{children:Object(j.jsx)("button",{id:"export",onClick:this.props.export_code,children:" Export "})})]})}}]),s}(n.a.Component),z=function(e){Object(p.a)(s,e);var t=Object(m.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).state={sim_time:0},i}return Object(d.a)(s,[{key:"render",value:function(){return Object(j.jsxs)("div",{style:{position:"absolute",bottom:0},children:[Object(j.jsx)(b.e,{onClick:this.props.zoomIn}),Object(j.jsx)(b.h,{onClick:this.props.zoomOut}),Object(j.jsxs)("div",{style:{float:"right"},children:[" ",this.state.sim_time.toFixed(2)," "]})]})}}]),s}(n.a.Component),E=function(e){Object(p.a)(s,e);var t=Object(m.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).initial_state_component=null,i.transition_state_component=null,i.colour_map_component=null,i.simulator_component=null,i.header_component=null,i.model_stats_component=null,i.model_tabs=null,i.playing_simulation=!1,i.state={model:new v.a({initial_state:Array.from({length:5},(function(){return Array.from({length:5},(function(){return"I"}))}))}),playing_simulation:!1,sim_time:0},i}return Object(d.a)(s,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{className:"main_grid grid",children:[Object(j.jsx)(x,{playPressed:this.playPressed.bind(this),stepBackPressed:this.stepBackwardPressed.bind(this),stepForwardPressed:this.stepForwardPressed.bind(this),fastBackwardPressed:this.fastBackwardPressed.bind(this),fastForwardPressed:this.fastForwardPressed.bind(this),stopPressed:this.stopPressed.bind(this),ref:function(t){return e.header_component=t}}),Object(j.jsxs)(f.d,{className:"panel state_panel",ref:function(t){return e.model_tabs=t},forceRenderTabPanel:!0,onSelect:this.onTabSelect.bind(this),children:[Object(j.jsxs)(f.b,{children:[Object(j.jsx)(f.a,{children:"Initial State"}),Object(j.jsx)(f.a,{children:"Simulator"})]}),Object(j.jsx)(f.c,{style:{height:"100%"},children:Object(j.jsx)(S,{current_state:this.state.model.initial_state,colour_map:this.state.model.colour_map,geometry:this.state.model.geometry,ref:function(t){return e.initial_state_component=t},update_state:this.updateInitState.bind(this),size:this.state.model.pixels_per_node})}),Object(j.jsxs)(f.c,{style:{height:"100%",position:"relative"},children:[Object(j.jsx)("div",{style:{height:"90%"},children:Object(j.jsx)(S,{current_state:this.state.model.current_state,colour_map:this.state.model.colour_map,geometry:this.state.model.geometry,ref:function(t){return e.simulator_component=t},update_state:this.updateSimState.bind(this),size:this.state.model.pixels_per_node})}),Object(j.jsx)(z,{model:this.state.model,sim_time:this.state.sim_time,ref:function(t){return e.model_stats_component=t},zoomIn:this.zoomIn.bind(this),zoomOut:this.zoomOut.bind(this)})]})]}),Object(j.jsx)(N,{ref:function(t){return e.colour_map_component=t},model:this.state.model,refreshColour:this.refreshColour.bind(this),addColour:this.addColour.bind(this),deleteColour:this.deleteColour.bind(this)}),Object(j.jsx)(C,{ref:function(t){return e.transition_state_component=t},model:this.state.model,addRule:this.addRule.bind(this),deleteRule:this.deleteRule}),Object(j.jsx)(A,{export_code:this.export_code.bind(this),import_code:this.import_code.bind(this),import_example:this.import_example.bind(this)})]})}},{key:"import_code",value:function(){var e=Object(c.a)(l.a.mark((function e(){var t,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=document.getElementById("import_input").files)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,v.a.parser.parse_import_files(Object(u.a)(t));case 5:!1===(s=e.sent)||this.update_page(s);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"export_code",value:function(){var e=this.state.model.export(),t=new Blob([e],{type:"text/plain"}),s=document.createElement("a");s.download="surface_crn_export.txt",s.href=(window.webkitURL||window.URL).createObjectURL(t),s.dataset.downloadurl=["text/plain",s.download,s.href].join(":"),s.click()}},{key:"import_example",value:function(e){if(null!==e&&""!==e){var t=this;fetch(e,{headers:{"Content-Type":"application/text",Accept:"application/text"}}).then((function(e){return e.text()})).then((function(e){var s=v.a.parser.parse_code(e.split("\n"));t.update_page(s)}))}}},{key:"setPlaying",value:function(e){this.playing_simulation=e,this.header_component.setState({simPlaying:e})}},{key:"update_page",value:function(e){this.setPlaying(!1),this.model_tabs.setState({selectedIndex:0}),this.setState({model:e}),this.transition_state_component.setState({rules_list:this.state.model.rules}),this.colour_map_component.setState({colours:this.state.model.colour_map.colours}),this.update_init_state(this.state.model.initial_state,this.state.model.colour_map,this.state.model.geometry)}},{key:"update_init_state",value:function(e,t,s){this.initial_state_component.setState({colour_map:t,geometry:s,size:this.state.model.pixels_per_node}),this.initial_state_component.updateColsAndData(e)}},{key:"refreshInitState",value:function(){this.update_init_state(this.state.model.initial_state,this.state.model.colour_map,this.state.model.geometry),this.initial_state_component.setState({size:this.state.model.pixels_per_node})}},{key:"updateInitState",value:function(e,t,s){this.state.model.initial_state[e][t]=s,this.refreshInitState()}},{key:"updateSimState",value:function(e,t,s){this.state.model.current_state[e][t]=s,this.refreshSimState()}},{key:"refreshSimState",value:function(){this.model_stats_component.setState({sim_time:this.state.model.sim_time}),this.simulator_component.setState({colour_map:this.state.model.colour_map}),this.simulator_component.updateColsAndData(this.state.model.current_state),this.simulator_component.setState({size:this.state.model.pixels_per_node})}},{key:"refreshColour",value:function(){this.refreshInitState(),this.refreshSimState()}},{key:"startSimulation",value:function(){this.state.model.start_sim(),this.refreshSimState(),console.log("sim started")}},{key:"showSimulation",value:function(){this.model_tabs.setState({selectedIndex:1}),this.state.model.sim_started()||this.startSimulation()}},{key:"onTabSelect",value:function(e,t,s){e!==t&&1===e&&this.startSimulation()}},{key:"playPressed",value:function(){this.showSimulation(),this.playing_simulation?this.setPlaying(!1):(this.setPlaying(!0),this.playSimulation(!0))}},{key:"playSimulation",value:function(e){if(e||this.playing_simulation){var t=this.state.model.next_frame();this.refreshSimState(),t?window.setTimeout(this.playSimulation.bind(this),1/this.state.model.fps):this.setPlaying(!1)}}},{key:"stepForwardPressed",value:function(){this.showSimulation(),this.state.model.step_forward()||console.log("sim finished"),this.refreshSimState(),console.log("step forward")}},{key:"stepBackwardPressed",value:function(){this.showSimulation(),this.state.model.step_backward()||console.log("sim start"),this.refreshSimState(),console.log("step backward")}},{key:"fastForwardPressed",value:function(){this.showSimulation(),this.state.model.next_frame()||console.log("sim finished"),this.refreshSimState(),console.log("step forward")}},{key:"fastBackwardPressed",value:function(){this.showSimulation(),this.state.model.prev_frame()||console.log("sim start"),this.refreshSimState(),console.log("step backward")}},{key:"stopPressed",value:function(){this.setPlaying(!1),this.model_tabs.setState({selectedIndex:0}),this.state.model.stop_sim(),this.refreshSimState()}},{key:"addColour",value:function(){var e=this.state.model.colour_map.new_colour();this.state.model.colour_map.add(new _.Colour(Object.assign(_.Colour.hex2rgb(e),{name:"New"}))),this.colour_map_component.setState({colours:this.state.model.colour_map.colours})}},{key:"deleteColour",value:function(e){this.state.model.colour_map.delete(e),this.colour_map_component.setState({colours:this.state.model.colour_map.colours})}},{key:"deleteRule",value:function(e){this.state.model.remove_rule(e),this.transition_state_component.setState({rules_list:Object(u.a)(this.state.model.rules)})}},{key:"addRule",value:function(){this.state.model.add_rule(),this.transition_state_component.setState({rules_list:Object(u.a)(this.state.model.rules)})}},{key:"zoomOut",value:function(){this.state.model.increase_size(),this.refreshSimState(),this.refreshInitState()}},{key:"zoomIn",value:function(){this.state.model.decrease_size(),this.refreshSimState(),this.refreshInitState()}}]),s}(n.a.Component);r.a.render(Object(j.jsxs)(n.a.StrictMode,{children:[Object(j.jsx)("title",{children:" Surface CRN Simulator "}),Object(j.jsx)(E,{})]}),document.getElementById("root"))},26:function(e,t,s){"use strict";var i=s(11),n=s(13);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(t){i(this,e),this.original_string="",this.matched=[],this.update_matched(t)}return n(e,[{key:"includes",value:function(e){return e===this.original_string}},{key:"is_pure",value:function(){return null===this.original_string.match(/^\w+$/)}},{key:"toString",value:function(){return this.original_string}},{key:"update_matched",value:function(e){this.original_string=e,this.matched=this.decompose_matcher(e)}},{key:"decompose_matcher",value:function(e){var t,s=this;if(t=e.match(/^(.*)\[[^[]+\](.*)$/))return t[2].split(t[2].match("|")?"|":"").map((function(e){return s.decompose_matcher(t[1]+e+t[2])})).flat();if(e.matchAll(/\{[^}]+\}/g));else if(t=e.match(/^(.*)\([^(]+\)(.*)$/)){return t[2].split("|").map((function(e){return s.decompose_matcher(t[1]+e+t[2])})).flat()}return[e]}}]),e}();t.default=a},48:function(e,t,s){"use strict";var i=s(11),n=s(13),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=a(s(26)),o=function(){function e(t){i(this,e),this.is_mono=!0,this.reactants=[],this.products=[],this.decomposed=[],this.rate=1,this.update(t)}return n(e,[{key:"toString",value:function(){return"("+this.rate.toString()+") "+[this.reactants,this.products].map((function(e){return e.map((function(e){return e.toString()})).join(" + ")})).join(" -> ")}},{key:"update",value:function(e){Object.assign(this,e),this.is_mono=this.reactants.length<2&&this.products.length<2}},{key:"matches",value:function(e,t){if(this.is_mono===(void 0!==t))return!1;if(this.is_mono){if(this.reactants[0].includes(e))return[this.products[0].original_string]}else if(this.reactants[0].includes(e)&&this.reactants[1].includes(t))return[this.products[0].original_string,this.products[1].original_string];return!1}}],[{key:"blankRule",value:function(){return new e({is_mono:!0,reactants:[new r.default("")],products:[new r.default("")]})}}]),e}();t.default=o},49:function(e,t,s){"use strict";var i=s(11),n=s(13),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=a(s(26)),o=function(){function e(t){i(this,e),this.red=0,this.green=0,this.blue=0,this.species=new Set,this.name="","string"===typeof t&&(t=e.hex2rgb(t)),this.update_colour(t)}return n(e,[{key:"rgb",value:function(){return[this.red,this.green,this.blue]}},{key:"hex",value:function(){return"#"+this.rgb().map((function(e){return("0"+e.toString(16)).slice(-2)})).join("")}},{key:"update_colour",value:function(e){Object.assign(this,e)}},{key:"add_matcher",value:function(e){this.species.add(new r.default(e))}},{key:"delete_matcher",value:function(e){this.species.delete(e)}}],[{key:"white",value:function(){return new e({red:256,green:256,blue:256})}},{key:"hex2rgb",value:function(e){var t=(e=e.replace(/^#/,"")).match(/^([A-Fa-f\d]{2})([A-Fa-f\d]{2})([A-Fa-f\d]{2})$/);return t?{red:parseInt(t[1],16),green:parseInt(t[2],16),blue:parseInt(t[3],16)}:{red:256,green:256,blue:256}}}]),e}();t.default=o},7:function(e,t,s){"use strict";var i=s(46),n=s(36),a=s(37),r=s(11),o=s(13),l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Colour=t.Colour_Map=t.Transition_Rule=t.Species_Matcher=void 0;var u=l(s(26));t.Species_Matcher=u.default;var c=l(s(48));t.Transition_Rule=c.default;var h=l(s(77));t.Colour_Map=h.default;var d=l(s(49));t.Colour=d.default;var p=l(s(78)),m=s(79),f=l(s(81)),_=l(s(134)),v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.initial_state=[],this.rules=[],this.colour_map=new h.default,this.options=new Map,this.geometry="square",this.rng_seed=null,this.pixels_per_node=20,this.speedup_factor=.5,this.fps=30,this.current_state=[],this.last_updated=[],this.sim_time=0,this.sim_queue=null,this.sim_history=[],this.rule_check_cache={},Object.assign(this,t)}return o(e,[{key:"remove_rule",value:function(e){this.rules.splice(this.rules.indexOf(e),1)}},{key:"add_rule",value:function(){this.rules.push(c.default.blankRule())}},{key:"set_option",value:function(e,t){switch(e){case"geometry":if("square"!==t&&"hex"!==t)throw"Invalid option: Geometry";this.geometry=t;break;case"rng_seed":var s=parseInt(t);this.rng_seed=s;break;case"pixels_per_node":s=parseInt(t);this.pixels_per_node=s;break;case"speedup_factor":s=parseInt(t);this.speedup_factor=s;break;case"fps":s=parseInt(t);this.fps=s}this.options.set(e,t)}},{key:"export",value:function(){var e,t=[],s=a(this.options);try{for(s.s();!(e=s.n()).done;){var r=i(e.value,2),o=r[0],l=r[1];t.push(o+" = "+l)}}catch(u){s.e(u)}finally{s.f()}return t.push("!START_TRANSITION_RULES"),t.push.apply(t,n(this.rules.map((function(e){return e.toString()})))),t.push("!END_TRANSITION_RULES\n"),t.push(["!START_COLORMAP"]),t.push.apply(t,n(this.colour_map.export())),t.push(["!END_COLORMAP\n"]),t.push(["!START_INIT_STATE"]),t.push.apply(t,n(this.initial_state.map((function(e){return e.join(" ")})))),t.push(["!END_INIT_STATE\n"]),t.join("\n")}},{key:"stop_sim",value:function(){this.current_state=[],this.last_updated=[],this.sim_time=0,this.sim_queue=null,this.sim_history=[],this.rule_check_cache={},this.colour_map.clear_temp()}},{key:"start_sim",value:function(){var e=this;this.stop_sim(),null!==this.rng_seed&&_.default.clone(this.rng_seed),this.sim_queue=new f.default({comparator:function(e,t){return e.execution_time-t.execution_time}});var t=[];this.initial_state.forEach((function(s,i){e.last_updated.push(Array(s.length).fill(0)),e.current_state.push([]),s.forEach((function(s,n){e.current_state[e.current_state.length-1].push(e.initial_state[i][n]);var r,o=e.find_next_transitions(n,i),l=a(o);try{for(l.s();!(r=l.n()).done;){var u=r.value;t.push(u)}}catch(c){l.e(c)}finally{l.f()}}))})),this.sim_queue=new f.default({comparator:function(e,t){return e.execution_time-t.execution_time},initialValues:t})}},{key:"get_next_transition",value:function(){var e=this;if(this.sim_started()){for(var t=function(){var t=e.sim_queue.peek();if(t.new_cells.every((function(s){var n=i(s,3),a=n[0],r=n[1];n[2];return e.last_updated[r][a]<=t.update_time})))return"break";e.sim_queue.dequeue()};0!=this.sim_queue.length;){if("break"===t())break}return 0!=this.sim_queue.length&&this.sim_queue.peek()}return!1}},{key:"run_upto",value:function(e){for(;this.sim_time<e;){var t=this.get_next_transition();if(!1===t)return!1;if(t.execution_time>e)break;this.step_forward()}return this.sim_time=e,!0}},{key:"run_backto",value:function(e){for(;this.sim_time>e;){if(!1===this.step_backward())return!1}return this.sim_time=e,!0}},{key:"next_frame",value:function(){return this.run_upto(this.sim_time+1*this.speedup_factor/this.fps)}},{key:"prev_frame",value:function(){return this.run_backto(this.sim_time-1*this.speedup_factor/this.fps)}},{key:"step_forward",value:function(){var e=this;if(this.sim_started()){var t=this.get_next_transition();if(!1===t)return!1;if(this.sim_queue.dequeue(),this.sim_time=t.execution_time,t.new_cells.forEach((function(t){var s=i(t,3),n=s[0],a=s[1],r=s[2];e.current_state[a][n]=r,e.last_updated[a][n]=e.sim_time})),null===t.new_transitions){t.new_transitions=[];var s=new Set;t.new_cells.forEach((function(n){var r,o=i(n,3),l=o[0],u=o[1],c=(o[2],e.find_next_transitions(l,u,s)),h=a(c);try{for(h.s();!(r=h.n()).done;){var d=r.value;e.sim_queue.queue(d),t&&t.new_transitions.push(d)}}catch(p){h.e(p)}finally{h.f()}s.add([l,u])}))}else t.new_transitions.forEach((function(t){e.sim_queue.queue(t)}));return this.sim_history.push(t),0!=this.sim_queue.length}return!1}},{key:"step_backward",value:function(){var e=this;if(this.sim_started()){var t=this.sim_history.pop();return void 0!==t&&(this.sim_time=t.execution_time,t.old_cells.forEach((function(t){var s=i(t,3),n=s[0],a=s[1],r=s[2];e.current_state[a][n]=r,e.last_updated[a][n]=0})),this.sim_queue.queue(t),!0)}return!1}},{key:"find_next_transitions",value:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,n=this.current_state[t][e],r=[],o=[],l=this.rule_check_cache[n];o=void 0===l?this.rules:l;var u,c=a(o);try{for(c.s();!(u=c.n()).done;){var h=u.value;if(h.is_mono){var d=h.matches(n);if(d){var m=this.sim_time+Math.log(1/_.default.float())/h.rate,f=new p.default(this.sim_time,m);f.add_old_cell(e,t,n),f.add_new_cell(e,t,d[0]),r.push(f)}}else{var v=[];"square"==this.geometry&&(v=[[-1,0],[0,-1],[1,0],[0,1]]);for(var b=0,j=v;b<j.length;b++){var x=i(j[b],2),y=x[0],g=x[1];if(t+g>=0&&t+g<this.current_state.length&&e+y>=0&&e+y<this.current_state[t+g].length){if(s.has([e+y,t+g]))continue;var k=this.current_state[t+g][e+y],O=h.matches(n,k);if(O){var w=this.sim_time+Math.log(1/_.default.float())/h.rate,S=new p.default(this.sim_time,w);S.add_old_cell(e,t,n),S.add_old_cell(e+y,t+g,k),S.add_new_cell(e,t,O[0]),S.add_new_cell(e+y,t+g,O[1]),r.push(S)}if(O=h.matches(k,n)){var C=this.sim_time+Math.log(1/_.default.float())/h.rate,R=new p.default(this.sim_time,C);R.add_old_cell(e,t,n),R.add_old_cell(e+y,t+g,k),R.add_new_cell(e,t,O[1]),R.add_new_cell(e+y,t+g,O[0]),r.push(R)}}}}}}catch(P){c.e(P)}finally{c.f()}return r}},{key:"sim_started",value:function(){return null!==this.sim_queue}},{key:"increase_size",value:function(){this.pixels_per_node+=1}},{key:"decrease_size",value:function(){this.pixels_per_node<=1?this.pixels_per_node-=.1:this.pixels_per_node-=1}}]),e}();t.default=v,v.parser={parse_import_files:m.parse_import_files,parse_code:m.parse_code}},77:function(e,t,s){"use strict";var i=s(36),n=s(37),a=s(11),r=s(13);Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t){a(this,e),this.colours=new Set,this.example_colours=["#ffffff","#000000","#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#42d4f4","#f032e6","#bfef45","#fabed4","#469990","#dcbeff","#9A6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#a9a9a9"],this.temp_colours=new Map,t&&(this.colours=t)}return r(e,[{key:"find_colour",value:function(e){var t,s=n(this.colours);try{for(s.s();!(t=s.n()).done;){var a=t.value;if(i(a.species.values()).some((function(t){return t.includes(e)})))return a}}catch(o){s.e(o)}finally{s.f()}var r=this.temp_colours.get(e);return void 0===r?null:r}},{key:"export",value:function(){return i(this.colours.values()).map((function(e){return"{"+e.name+"} "+i(e.species.values()).map((function(e){return e.toString()})).join(" ")+" : ("+e.rgb().join(",")+")"}))}},{key:"new_colour",value:function(){var e=this,t=this.example_colours.find((function(t){return void 0===[].concat(i(e.temp_colours.values()),i(e.colours.values())).find((function(e){return e.hex()===t}))}));return void 0===t?"#000000":t}},{key:"add",value:function(e){this.colours.add(e)}},{key:"delete",value:function(e){this.colours.delete(e)}},{key:"add_temp",value:function(e,t){this.temp_colours.set(e,t)}},{key:"clear_temp",value:function(){this.temp_colours.clear()}}]),e}();t.default=o},78:function(e,t,s){"use strict";var i=s(11),n=s(13);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(t,s){i(this,e),this.old_cells=[],this.new_cells=[],this.new_transitions=null,this.update_time=t,this.execution_time=s}return n(e,[{key:"add_old_cell",value:function(e,t,s){this.old_cells.push([e,t,s])}},{key:"add_new_cell",value:function(e,t,s){this.new_cells.push([e,t,s])}},{key:"add_future_transitions",value:function(e){this.new_transitions=e}}]),e}();t.default=a},79:function(e,t,s){"use strict";var i=s(30),n=s(36),a=s(11),r=s(80),o=s(37),l=s(46),u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parse_import_files=t.parse_code=void 0;var c=u(s(26)),h=u(s(48)),d=u(s(49)),p=u(s(7));function m(e,t){var s=function(e){if(1!=(e.match(/->/g)||[]).length)return!1;var t=1,s=(e=e.replace(/\((\d*(?:\.\d+)?)\)/,(function(e,s){return t=+s,""}))).split("->").map((function(e){return e.split("+").map((function(e){return new c.default(e.trim())}))})),i=l(s,2),n=i[0],a=i[1];return!(n.length!=a.length||n.length>2||0==n.length)&&new h.default({reactants:n,products:a,rate:t,is_mono:1==n.length})}(e);if(!1!==s)return t.rules.push(s),!0;var i=function(e){var t=e.match(/^(?:\{([^}]+)\})? *((?: *[^,: ]+,? *?)+) *: *\((\d+) *, *(\d+) *, *(\d+)\)$/);if(null==t)return!1;var s=t[2].split(/,\s*|\s+/).map((function(e){return new c.default(e.trim())}));return new d.default({name:t[1]||t[2],species:new Set(s),red:+t[3],green:+t[4],blue:+t[5]})}(e);if(!1!==i)return t.colour_map.add(i),!0;var n=function(e){return 1==(e.match(/=/g)||[]).length&&e.split("=").map((function(e){return e.trim()}))}(e);if(!1!==n){var a=l(n,2),r=a[0],o=a[1];return t.set_option(r,o),!0}return!1}function f(e){return e.split(/\s+|,/)}function _(e){var t,s=!1,i=new p.default,n=o(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(""!=(a=a.trim().replace(/#.*/,"")))if(s){if("!END_INIT_STATE"==a){s=!1;continue}var r=f(a);i.initial_state.push(r)}else{if("!START_INIT_STATE"==a){s=!0;continue}m(a,i)}}}catch(l){n.e(l)}finally{n.f()}return i}function v(){return(v=r(i.mark((function e(t){var s,r,u,c,h,d,p,m,f,v,b,j,x,y,g,k,O;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return console.log("No input files"),e.abrupt("return",!1);case 3:s=function e(){a(this,e),this.data=[],this.imported=!1},r=new Map,u=o(t),e.prev=7,u.s();case 9:if((c=u.n()).done){e.next=18;break}return h=c.value,d=new s,e.next=14,h.text();case 14:d.data=e.sent.split("\n").map((function(e){return e.trim().replace(/#.*/,"")})),r.set(h.name,d);case 16:e.next=9;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(7),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:p=o(r);try{for(p.s();!(m=p.n()).done;){f=l(m.value,2),f[0],v=f[1],b=o(v.data);try{for(b.s();!(j=b.n()).done;)j.value.match(/^!INCLUDE /)}catch(i){b.e(i)}finally{b.f()}}}catch(i){p.e(i)}finally{p.f()}x=[],y=o(r);try{for(y.s();!(g=y.n()).done;)k=l(g.value,2),k[0],(O=k[1]).imported||x.push.apply(x,n(O.data))}catch(i){y.e(i)}finally{y.f()}return e.abrupt("return",_(x));case 32:case"end":return e.stop()}}),e,null,[[7,20,23,26]])})))).apply(this,arguments)}t.parse_code=_,t.parse_import_files=function(e){return v.apply(this,arguments)}},91:function(e,t){},92:function(e,t,s){}},[[135,1,2]]]);
//# sourceMappingURL=main.ed4e795b.chunk.js.map