(this.webpackJsonpsurface_crn_ide=this.webpackJsonpsurface_crn_ide||[]).push([[0],{134:function(e,t,n){"use strict";n.r(t);var i=n(0),s=n.n(i),a=n(23),r=n.n(a),o=n(29),u=n.n(o),l=n(12),c=n(58),d=n(2),h=n(3),p=n(5),f=n(4),_=n(14),m=(n(70),n(6)),v=n.n(m),b=(n(91),n(8)),j=n(1),x=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){return Object(d.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"render",value:function(){return Object(j.jsx)("header",{className:"grid",children:Object(j.jsxs)("nav",{className:"grid",children:[Object(j.jsx)("h2",{className:"grid title",children:"Surface CRN Simulator"}),Object(j.jsx)("h4",{className:"grid simulator_options",children:"(sim options)"}),Object(j.jsxs)("h4",{className:"simulator_controls",children:[Object(j.jsx)(b.e,{onClick:this.props.stepBackPressed}),Object(j.jsx)(b.c,{onClick:this.props.playPressed}),Object(j.jsx)(b.f,{onClick:this.props.stepForwardPressed})]})]})})}}]),n}(s.a.Component),g=n(62),y=function(){function e(t,n){Object(d.a)(this,e),this.x=void 0,this.y=void 0,this.x=t,this.y=n}return Object(h.a)(e,[{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"subtract",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"scale",value:function(t){return new e(this.x*t,this.y*t)}}]),e}();y.origin=new y(0,0);var O=y,k=n(44),w=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var i;Object(d.a)(this,n),(i=t.call(this,e)).onCellDataChanged=function(e){i.props.update_state(e.rowIndex-1,e.colIndex-1,e.newData)};var s=e.current_state,a=e.colour_map,r=e.grid_type;return i.state={columns:i.createCols(s),data:i.createData(s),colour_map:a,grid_type:r,offset:O.origin},i}return Object(h.a)(n,[{key:"render",value:function(){return console.log("rendAll"),Object(j.jsx)(k.ReactCanvasGrid,{columns:this.state.columns,data:this.state.data,rowHeight:20,onCellDataChanged:this.onCellDataChanged})}},{key:"updateColsAndData",value:function(e){this.setState({columns:this.createCols(e),data:this.createData(e)})}},{key:"createCols",value:function(e){var t=[],n=0;0!==e.length&&(n=e[0].length),t.push({fieldName:"addLeftCol",width:20});for(var i=0;i<n;i++)t.push({fieldName:i.toString(),width:20});return t.push({fieldName:"addRightCol",width:20}),t}},{key:"createData",value:function(e){for(var t=this,n=[],i=-1;i<=e.length;i++){var s={};if(-1!==i&&i!==e.length)for(var a=0;a<e[0].length;a++)s[a.toString()]={data:e[i][a],getText:function(e){return e||""},renderBackground:function(e,n,i,s){if(null!==i.data){var a=t.state.colour_map.find_colour(i.data);if(null==a){var r=t.state.colour_map.new_colour();a=new m.Colour(r),t.state.colour_map.add_temp(i.data,a),console.log(i.data,a)}e.fillStyle="rgb("+a.rgb().join(",")+")",e.fillRect(n.left,n.top,n.width,n.height)}},renderText:function(e,n,i){var s=Object(k.cellHasTextFunction)(i)?i.getText(i.data):i.text;if(s){var a=t.state.colour_map.find_colour(i.data);if(null==a){var r=t.state.colour_map.new_colour();a=new m.Colour(r),t.state.colour_map.add_temp(i.data,a),console.log(i.data,a)}var o=a.rgb(),u=Object(g.a)(o,3),l=u[0],c=u[1],d=u[2];e.fillStyle=.299*l+.587*c+.114*d>186?"black":"white",e.fillText(s,n.left+2,n.top+10,n.width-4)}},editor:{serialise:function(e){return e||""},deserialise:function(e,t){return(e=e.trim()).match(/^\w+$/)?e:t}}};else if(0!=e.length)for(var r=0;r<e[0].length;r++)s[r.toString()]={data:null,text:"",renderBackground:function(){return 1}};s.addLeftCol={data:null,text:"",renderBackground:function(){return 1}},s.addRightCol={data:null,text:"",renderBackground:function(){return 1}},n.push(s)}return n}}]),n}(s.a.Component),S=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).state={rules_list:e.model.rules},i}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{className:"grid panel rules_panel",children:[Object(j.jsx)("h3",{className:"panel_header",children:" Transition Rules "}),Object(j.jsxs)("div",{id:"rule_container",children:[this.state.rules_list.map((function(t,n){return Object(j.jsx)(C,{rule:t,deleteRule:function(){return e.props.deleteRule(t)}},t.toString()+n.toString())})),Object(j.jsx)("div",{onClick:this.props.addRule,children:" Add Rule "})]})]})}}]),n}(s.a.Component),C=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).rule=void 0,i.deleteRule=void 0,i.rule=e.rule,i.state={reactant0:e.rule.reactants[0].original_string,reactant1:e.rule.is_mono?"":e.rule.reactants[1].original_string,product0:e.rule.products[0].original_string,product1:e.rule.is_mono?"":e.rule.products[1].original_string,rate:e.rule.rate},i.deleteRule=e.deleteRule,i}return Object(h.a)(n,[{key:"render",value:function(){return Object(j.jsxs)("div",{className:"rulesRow grid",children:[Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:this.state.rate,type:"number",className:"rulesRate",onChange:this.updateRule.bind(this),min:"0",step:"0.1"})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:this.state.reactant0,className:"rulesReactant0",onChange:this.updateRule.bind(this)})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)(b.d,{})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:this.state.reactant1,className:"rulesReactant1",onChange:this.updateRule.bind(this)})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)(b.b,{})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:this.state.product0,className:"rulesProduct0",onChange:this.updateRule.bind(this)})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)(b.d,{})," "]}),Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:this.state.product1,className:"rulesProduct1",onChange:this.updateRule.bind(this)})," "]}),Object(j.jsx)(b.g,{onClick:this.deleteRule})]})}},{key:"updateRule",value:function(e){var t=this.rule.reactants,n=this.rule.products,i=e.currentTarget.value;switch(e.target.className){case"rulesReactant0":t[0]=new m.Species_Matcher(i),this.rule.update({reactants:t}),this.setState({reactant0:i});break;case"rulesReactant1":t[1]=new m.Species_Matcher(i),this.rule.update({reactants:t}),this.setState({reactant1:i});break;case"rulesProduct0":n[0]=new m.Species_Matcher(i),this.rule.update({products:n}),this.setState({product0:i});break;case"rulesProduct1":n[1]=new m.Species_Matcher(i),this.rule.update({products:n}),this.setState({product1:i});break;case"rulesRate":n[1]=new m.Species_Matcher(i),this.rule.update({rate:+i}),this.setState({rate:+i})}}}]),n}(s.a.Component),R=n(31),N=n(60),T=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).state={colours:i.props.model.colour_map.colours},i}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{className:"grid panel colour_panel",children:[Object(j.jsx)("h3",{children:" Colour Mapping "}),Object(j.jsxs)("div",{id:"colour_container",children:[Object(l.a)(this.state.colours.values()).map((function(t){return Object(j.jsx)(M,{colour:t,onChange:e.props.refreshColour},t.name)})),Object(j.jsx)("div",{onClick:this.props.addColour.bind(this),style:{cursor:"pointer"},children:" Add Colour "})]})]})}}]),n}(s.a.Component),M=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).pickerRef=null,i.mouseDownInElement=!1,i.state={colour:e.colour.hex(),isOpen:!1,species:e.colour.species,name:e.colour.name,showList:!1},i.handleClickOutside=i.handleClickOutside.bind(Object(R.a)(i)),i}return Object(h.a)(n,[{key:"handleClickOutside",value:function(e){this.mouseDownInElement||!this.pickerRef||this.pickerRef.contains(e.target)||this.setState({isOpen:!1})}},{key:"handleDownClick",value:function(e){this.mouseDownInElement=!this.pickerRef||this.pickerRef.contains(e.target)}},{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handleDownClick.bind(this)),document.addEventListener("mouseup",this.handleClickOutside.bind(this))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleDownClick),document.removeEventListener("mouseup",this.handleClickOutside)}},{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{children:[Object(j.jsxs)("div",{className:"picker",children:[Object(j.jsx)("div",{className:"swatch",style:{backgroundColor:this.props.colour.hex()},onClick:function(){return!e.state.isOpen&&e.setState({isOpen:!e.state.isOpen})}}),Object(j.jsx)("input",{value:this.state.name,onChange:function(t){var n=t.currentTarget.value;e.setState({name:n}),e.props.colour.name=n}}),Object(j.jsx)(b.a,{size:25,style:{cursor:"pointer"},onClick:function(t){e.setState({showList:!e.state.showList})}})]}),this.state.isOpen&&Object(j.jsx)("div",{className:"popover",ref:function(t){return e.pickerRef=t},children:Object(j.jsx)(N.a,{color:this.props.colour.hex(),onChange:function(t){e.setState({colour:t}),e.updateColour(t)}})}),this.state.showList&&Object(j.jsxs)("div",{className:"flexBox",children:[Object(l.a)(this.state.species.values()).map((function(t){return Object(j.jsxs)("div",{children:[" ",Object(j.jsx)("input",{value:t.original_string,className:"",onChange:e.updateSpecies(t).bind(e)})," ",Object(j.jsx)(b.g,{onClick:function(){return e.deleteMatcher(t)}})]})})),Object(j.jsx)("div",{style:{cursor:"pointer"},onClick:this.addMatcher.bind(this),children:" Add Species "}),Object(j.jsx)("hr",{})]})]})}},{key:"updateColour",value:function(e){this.props.colour.update_colour(m.Colour.hex2rgb(e)),this.props.onChange()}},{key:"updateSpecies",value:function(e){var t=this;return function(n){e.update_matcher(n.target.value),t.setState({species:t.props.colour.species}),t.props.onChange()}}},{key:"addMatcher",value:function(){this.props.colour.add_matcher(""),this.setState({species:this.props.colour.species})}},{key:"deleteMatcher",value:function(e){this.props.colour.delete_matcher(e),this.setState({species:this.props.colour.species})}}]),n}(s.a.Component),I=n(45),A=n(61),E=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).state={example_selected:""},i}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{className:"grid panel import_export_panel",children:[Object(j.jsx)("h3",{children:" Import/Export "}),Object(j.jsxs)("div",{children:[Object(j.jsx)(A.a,{options:[{value:"./examples/two-bit-adder.txt",label:"Two Bit Adder"},{value:"./examples/alternate_line_builder.txt",label:"Line Builder"},{value:"./examples/Brusselator.txt",label:"Brusselator"},{value:"./examples/busy_beaver.txt",label:"Busy Beaver"},{value:"./examples/ertl.txt",label:"Ertl Oscillator"},{value:"./examples/game_of_life_5x5_circuit.txt",label:"GoL Five by Five"},{value:"./examples/game_of_life_one_to_one.txt",label:"GoL One to One"},{value:"./examples/GH_big_spiral.txt",label:"Greenberg-Hastings Big spiral"},{value:"./examples/majority_asynchronous.txt",label:"Majority Asynchronous"},{value:"./examples/molecular_walker.txt",label:"Molecular Walker"},{value:"./examples/parens_matcher.txt",label:"Parens Matcher"},{value:"./examples/sierpinski_1D_synch.txt",label:"1D Sierpinski"},{value:"./examples/smarter_scout_ant.txt",label:"Smarter Scout Ant"}],isSearchable:!0,isClearable:!0,onChange:function(t,n){return e.setState({example_selected:t&&t.value})},styles:{option:function(e,t){return Object(I.a)(Object(I.a)({},e),{},{color:"black"})}}}),Object(j.jsx)("button",{disabled:""===this.state.example_selected,type:"submit",id:"import_example",onClick:function(){return e.props.import_example(e.state.example_selected)},children:" Import Example "})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("input",{type:"file",id:"import_input",multiple:!0}),Object(j.jsx)("button",{type:"submit",id:"import_submit",onClick:this.props.import_code,children:" Import "})]}),Object(j.jsx)("div",{children:Object(j.jsx)("button",{id:"export",onClick:this.props.export_code,children:" Export "})})]})}}]),n}(s.a.Component),D=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).initial_state_component=null,i.transition_state_component=null,i.colour_map_component=null,i.simulator_component=null,i.simulation_running=!1,i.model_tabs=null,i.playing_simulation=!1,i.step_time=.5,i.state={model:new v.a({initial_state:Array.from({length:5},(function(){return Array.from({length:5},(function(){return"I"}))}))})},i}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{className:"main_grid grid",children:[Object(j.jsx)(x,{playPressed:this.playPressed.bind(this),stepBackPressed:this.stepBackPressed.bind(this),stepForwardPressed:this.stepForwardPressed.bind(this)}),Object(j.jsxs)(_.d,{className:"panel state_panel",ref:function(t){return e.model_tabs=t},forceRenderTabPanel:!0,children:[Object(j.jsxs)(_.b,{children:[Object(j.jsx)(_.a,{children:"Initial State"}),Object(j.jsx)(_.a,{children:"Simulator"})]}),Object(j.jsx)(_.c,{style:{height:"100%"},children:Object(j.jsx)(w,{current_state:this.state.model.initial_state,colour_map:this.state.model.colour_map,grid_type:this.state.model.grid_type,ref:function(t){return e.initial_state_component=t},update_state:this.updateInitState.bind(this)})}),Object(j.jsx)(_.c,{style:{height:"100%"},children:Object(j.jsx)(w,{current_state:this.state.model.current_state,colour_map:this.state.model.colour_map,grid_type:this.state.model.grid_type,ref:function(t){return e.simulator_component=t},update_state:this.updateSimState.bind(this)})})]}),Object(j.jsx)(T,{ref:function(t){return e.colour_map_component=t},model:this.state.model,refreshColour:this.refreshColour.bind(this),addColour:this.addColour.bind(this),deleteColour:this.deleteColour.bind(this)}),Object(j.jsx)(S,{ref:function(t){return e.transition_state_component=t},model:this.state.model,addRule:this.addRule,deleteRule:this.deleteRule}),Object(j.jsx)(E,{export_code:this.export_code.bind(this),import_code:this.import_code.bind(this),import_example:this.import_example.bind(this)})]})}},{key:"import_code",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=document.getElementById("import_input").files)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,v.a.parser.parse_import_files(Object(l.a)(t));case 5:!1===(n=e.sent)||this.update_page(n);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"export_code",value:function(){var e=this.state.model.export(),t=new Blob([e],{type:"text/plain"}),n=document.createElement("a");n.download="surface_crn_export.txt",n.href=(window.webkitURL||window.URL).createObjectURL(t),n.dataset.downloadurl=["text/plain",n.download,n.href].join(":"),n.click()}},{key:"import_example",value:function(e){if(null!==e&&""!==e){console.log(e);var t=this;fetch(e,{headers:{"Content-Type":"application/text",Accept:"application/text"}}).then((function(e){return e.text()})).then((function(e){var n=v.a.parser.parse_code(e.split("\n"));t.update_page(n)}))}}},{key:"update_page",value:function(e){this.playing_simulation=!1,this.model_tabs.setState({selectedIndex:0}),this.setState({model:e}),this.transition_state_component.setState({rules_list:this.state.model.rules}),this.colour_map_component.setState({colours:this.state.model.colour_map.colours}),this.update_init_state(this.state.model.initial_state,this.state.model.colour_map,this.state.model.grid_type)}},{key:"update_init_state",value:function(e,t,n){this.initial_state_component.setState({colour_map:t,grid_type:n}),this.initial_state_component.updateColsAndData(e)}},{key:"refreshInitState",value:function(){this.update_init_state(this.state.model.initial_state,this.state.model.colour_map,this.state.model.grid_type)}},{key:"updateInitState",value:function(e,t,n){this.state.model.initial_state[e][t]=n,this.refreshInitState()}},{key:"updateSimState",value:function(e,t,n){this.state.model.current_state[e][t]=n,this.refreshSimState()}},{key:"refreshSimState",value:function(){this.simulator_component.setState({colour_map:this.state.model.colour_map}),this.simulator_component.updateColsAndData(this.state.model.current_state)}},{key:"refreshColour",value:function(){this.refreshInitState(),this.refreshSimState()}},{key:"startSimulation",value:function(){this.state.model.start_sim(),this.refreshSimState(),console.log("sim started")}},{key:"showSimulation",value:function(){this.model_tabs.setState({selectedIndex:1}),this.state.model.sim_started()||this.startSimulation()}},{key:"onTabSelect",value:function(e,t,n){e!=t&&1==e&&this.startSimulation()}},{key:"playPressed",value:function(){this.showSimulation(),this.playing_simulation?this.playing_simulation=!1:(this.playing_simulation=!0,this.playSimulation(!0))}},{key:"playSimulation",value:function(e){if(this.playing_simulation){var t=this.state.model.run_upto(this.state.model.sim_time+this.step_time);this.simulator_component.updateColsAndData(this.state.model.current_state),t?window.setTimeout(this.playSimulation.bind(this),1):this.playing_simulation=!1}}},{key:"stepForwardPressed",value:function(){this.showSimulation(),this.state.model.step_forward()||console.log("sim finished"),this.simulator_component.updateColsAndData(this.state.model.current_state),console.log("step forward")}},{key:"stepBackPressed",value:function(){this.showSimulation(),this.state.model.step_backward()||console.log("sim start"),this.simulator_component.updateColsAndData(this.state.model.current_state),console.log("step backward")}},{key:"addColour",value:function(){var e=this.state.model.colour_map.new_colour();this.state.model.colour_map.add(new m.Colour(Object.assign(m.Colour.hex2rgb(e),{name:"New"}))),this.colour_map_component.setState({colours:this.state.model.colour_map.colours})}},{key:"deleteColour",value:function(e){this.state.model.colour_map.delete(e),this.colour_map_component.setState({colours:this.state.model.colour_map.colours})}},{key:"deleteRule",value:function(e){this.state.model.remove_rule(e),this.transition_state_component.setState({rules_list:Object(l.a)(this.state.model.rules)})}},{key:"addRule",value:function(){this.state.model.add_rule(),this.transition_state_component.setState({rules_list:Object(l.a)(this.state.model.rules)})}}]),n}(s.a.Component);r.a.render(Object(j.jsxs)(s.a.StrictMode,{children:[Object(j.jsx)("title",{children:" Surface CRN Simulator "}),Object(j.jsx)(D,{})]}),document.getElementById("root"))},25:function(e,t,n){"use strict";var i=n(11),s=n(13);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(t){i(this,e),this.original_string="",this.matcher="",this.update_matcher(t)}return s(e,[{key:"includes",value:function(e){return null!==new RegExp(this.matcher).exec(e)}},{key:"is_pure",value:function(){return null===this.original_string.match(/^\w+$/)}},{key:"toString",value:function(){return this.original_string}},{key:"update_matcher",value:function(e){if(this.original_string=e,null!==e.match(/\\(\d|\(\d+\))/))throw Error();e=e.replace(/\\\((\d+)\)/g,"(?:\\$1)"),this.matcher="^(?:"+e+")$"}}]),e}();t.default=a},48:function(e,t,n){"use strict";var i=n(11),s=n(13),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(25)),o=function(){function e(t){i(this,e),this.is_mono=!0,this.reactants=[],this.products=[],this.rate=1,this.update(t)}return s(e,[{key:"toString",value:function(){return"("+this.rate.toString()+") "+[this.reactants,this.products].map((function(e){return e.map((function(e){return e.toString()})).join(" + ")})).join(" -> ")}},{key:"update",value:function(e){Object.assign(this,e),this.is_mono=this.reactants.length<2&&this.products.length<2}},{key:"matches",value:function(e,t){if(this.is_mono==(void 0!==t))return!1;if(this.is_mono){if(this.reactants[0].includes(e))return[this.products[0].original_string]}else if(this.reactants[0].includes(e)&&this.reactants[1].includes(t))return[this.products[0].original_string,this.products[1].original_string];return!1}}],[{key:"blankRule",value:function(){return new e({is_mono:!0,reactants:[new r.default("")],products:[new r.default("")]})}}]),e}();t.default=o},49:function(e,t,n){"use strict";var i=n(11),s=n(13),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(25)),o=function(){function e(t){i(this,e),this.red=0,this.green=0,this.blue=0,this.species=new Set,this.name="","string"===typeof t&&(t=e.hex2rgb(t)),this.update_colour(t)}return s(e,[{key:"rgb",value:function(){return[this.red,this.green,this.blue]}},{key:"hex",value:function(){return"#"+this.rgb().map((function(e){return("0"+e.toString(16)).slice(-2)})).join("")}},{key:"update_colour",value:function(e){Object.assign(this,e)}},{key:"add_matcher",value:function(e){this.species.add(new r.default(e))}},{key:"delete_matcher",value:function(e){this.species.delete(e)}}],[{key:"white",value:function(){return new e({red:256,green:256,blue:256})}},{key:"hex2rgb",value:function(e){var t=(e=e.replace(/^#/,"")).match(/^([A-Fa-f\d]{2})([A-Fa-f\d]{2})([A-Fa-f\d]{2})$/);return t?{red:parseInt(t[1],16),green:parseInt(t[2],16),blue:parseInt(t[3],16)}:{red:256,green:256,blue:256}}}]),e}();t.default=o},6:function(e,t,n){"use strict";var i=n(33),s=n(47),a=n(35),r=n(11),o=n(13),u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Colour=t.Colour_Map=t.Transition_Rule=t.Species_Matcher=void 0;var l=u(n(25));t.Species_Matcher=l.default;var c=u(n(48));t.Transition_Rule=c.default;var d=u(n(77));t.Colour_Map=d.default;var h=u(n(49));t.Colour=h.default;var p=u(n(78)),f=n(79),_=u(n(80)),m=u(n(133)),v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.initial_state=[],this.rules=[],this.colour_map=new d.default,this.options=new Map,this.grid_type="square",this.random_seed=null,this.current_state=[],this.last_updated=[],this.sim_time=0,this.sim_queue=null,this.sim_history=[],Object.assign(this,t)}return o(e,[{key:"remove_rule",value:function(e){this.rules.splice(this.rules.indexOf(e),1)}},{key:"add_rule",value:function(){this.rules.push(c.default.blankRule())}},{key:"export",value:function(){var e=[];return e.push("!START_TRANSITION_RULES"),e.push.apply(e,a(this.rules.map((function(e){return e.toString()})))),e.push("!END_TRANSITION_RULES"),e.push(["!START_COLORMAP"]),e.push.apply(e,a(this.colour_map.export())),e.push(["!END_COLORMAP"]),e.push(["!START_INIT_STATE"]),e.push.apply(e,a(this.initial_state.map((function(e){return e.join(" ")})))),e.push(["!END_INIT_STATE"]),e.join("\n")}},{key:"start_sim",value:function(){var e=this;this.current_state=this.initial_state.map((function(e){return a(e)})),null!==this.random_seed&&m.default.clone(this.random_seed),this.sim_history=[];var t=[],n=[];this.initial_state.forEach((function(i,s){e.last_updated.push(Array(i.length).fill(0)),i.forEach((function(i,a){var r=e.find_next_transition(a,s,n);r&&(t.push(r),n.push([a,s]))}))})),this.sim_queue=new _.default({comparator:function(e,t){return e.execution_time-t.execution_time},initialValues:t})}},{key:"get_next_transition",value:function(){var e=this;if(this.sim_started()){for(var t=function(){var t=e.sim_queue.peek();if(t.new_cells.every((function(n){var i=s(n,3),a=i[0],r=i[1];i[2];return e.last_updated[r][a]<=t.update_time})))return"break";e.sim_queue.dequeue()};0!=this.sim_queue.length;){if("break"===t())break}return 0!=this.sim_queue.length&&this.sim_queue.peek()}return!1}},{key:"run_upto",value:function(e){for(;this.sim_time<e;){var t=this.get_next_transition();if(!1===t)return!1;if(t.execution_time>e)break;this.step_forward()}return this.sim_time=e,!0}},{key:"step_forward",value:function(){var e=this;if(this.sim_started()){var t=this.get_next_transition();if(!1===t)return!1;if(this.sim_queue.dequeue(),this.sim_time=t.execution_time,t.new_cells.forEach((function(t){var n=s(t,3),i=n[0],a=n[1],r=n[2];e.current_state[a][i]=r,e.last_updated[a][i]=e.sim_time})),null===t.new_transitions){t.new_transitions=[];var n=[];t.new_cells.forEach((function(i){var a=s(i,3),r=a[0],o=a[1],u=(a[2],e.find_next_transition(r,o,n));null!==u&&(e.sim_queue.queue(u),t&&t.new_transitions.push(u),n.push([r,o]))}))}else t.new_transitions.forEach((function(t){e.sim_queue.queue(t)}));return this.sim_history.push(t),0!=this.sim_queue.length}return!1}},{key:"step_backward",value:function(){var e=this;if(this.sim_started()){var t=this.sim_history.pop();return void 0!==t&&(this.sim_time=t.execution_time,t.old_cells.forEach((function(t){var n=s(t,3),i=n[0],a=n[1],r=n[2];e.current_state[a][i]=r,e.last_updated[a][i]=0})),this.sim_queue.queue(t),!0)}return!1}},{key:"find_next_transition",value:function(e,t){var n,a=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=this.current_state[t][e],u=null,l=i(this.rules);try{for(l.s();!(n=l.n()).done;){var c=n.value;if(c.is_mono){var d=c.matches(o);if(d){var h=this.sim_time+Math.log(1/m.default.float())/c.rate;if(null!==u&&u.execution_time>h)continue;(u=new p.default(this.sim_time,h)).add_old_cell(e,t,o),u.add_new_cell(e,t,d[0])}}else{var f=[];"square"==this.grid_type&&(f=[[-1,0],[0,-1],[1,0],[0,1]]);for(var _=function(){var n=s(b[v],2),i=n[0],l=n[1];if(t+l>=0&&t+l<a.current_state.length&&e+i>=0&&e+i<a.current_state[t+l].length){if(r.some((function(n){var a=s(n,2),r=a[0],o=a[1];return r==e+i&&o==t+l})))return"continue";var d=a.current_state[t+l][e+i],h=c.matches(o,d);if(h){var f=a.sim_time+Math.log(1/m.default.float())/c.rate;if(u&&u.execution_time>f)return"continue";(u=new p.default(a.sim_time,f)).add_old_cell(e,t,o),u.add_old_cell(e+i,t+l,d),u.add_new_cell(e,t,h[0]),u.add_new_cell(e+i,t+l,h[1])}if(h=c.matches(d,o)){var _=a.sim_time+Math.log(1/m.default.float())/c.rate;if(u&&u.execution_time>_)return"continue";(u=new p.default(a.sim_time,_)).add_old_cell(e,t,o),u.add_old_cell(e+i,t+l,d),u.add_new_cell(e,t,h[1]),u.add_new_cell(e+i,t+l,h[0])}}},v=0,b=f;v<b.length;v++)_()}}}catch(j){l.e(j)}finally{l.f()}return u}},{key:"sim_started",value:function(){return null!=this.sim_queue}}]),e}();t.default=v,v.parser={parse_import_files:f.parse_import_files,parse_code:f.parse_code}},77:function(e,t,n){"use strict";var i=n(35),s=n(33),a=n(11),r=n(13);Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t){a(this,e),this.colours=new Set,this.example_colours=["#ffffff","#000000","#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#42d4f4","#f032e6","#bfef45","#fabed4","#469990","#dcbeff","#9A6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#a9a9a9"],this.temp_colours=new Map,t&&(this.colours=t)}return r(e,[{key:"find_colour",value:function(e){var t,n=s(this.colours);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(i(a.species.values()).some((function(t){return t.includes(e)})))return a}}catch(o){n.e(o)}finally{n.f()}var r=this.temp_colours.get(e);return void 0===r?null:r}},{key:"export",value:function(){return i(this.colours.values()).map((function(e){return"{"+e.name+"} "+i(e.species.values()).map((function(e){return e.toString()})).join(" ")+" : ("+e.rgb().join(",")+")"}))}},{key:"new_colour",value:function(){var e=this,t=this.example_colours.find((function(t){return void 0===[].concat(i(e.temp_colours.values()),i(e.colours.values())).find((function(e){return e.hex()===t}))}));return void 0===t?"#000000":t}},{key:"add",value:function(e){this.colours.add(e)}},{key:"delete",value:function(e){this.colours.delete(e)}},{key:"add_temp",value:function(e,t){this.temp_colours.set(e,t)}},{key:"clear_temp",value:function(){this.temp_colours.clear()}}]),e}();t.default=o},78:function(e,t,n){"use strict";var i=n(11),s=n(13);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(t,n){i(this,e),this.old_cells=[],this.new_cells=[],this.new_transitions=null,this.update_time=t,this.execution_time=n}return s(e,[{key:"add_old_cell",value:function(e,t,n){this.old_cells.push([e,t,n])}},{key:"add_new_cell",value:function(e,t,n){this.new_cells.push([e,t,n])}},{key:"add_future_transitions",value:function(e){this.new_transitions=e}}]),e}();t.default=a},79:function(e,t,n){"use strict";var i=n(29),s=n(35),a=n(11),r=n(33),o=n(47),u=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function r(e){try{u(i.next(e))}catch(t){a(t)}}function o(e){try{u(i.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}u((i=i.apply(e,t||[])).next())}))},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parse_import_files=t.parse_code=void 0;var c=l(n(25)),d=l(n(48)),h=l(n(49)),p=l(n(6));function f(e,t){var n=function(e){if(1!=(e.match(/->/g)||[]).length)return!1;var t=1,n=(e=e.replace(/\((\d+(?:\.\d+)?)\)/,(function(e,n){return t=+n,""}))).split("->").map((function(e){return e.split("+").map((function(e){return new c.default(e.trim())}))})),i=o(n,2),s=i[0],a=i[1];return!(s.length!=a.length||s.length>2||0==s.length)&&new d.default({reactants:s,products:a,rate:t,is_mono:1==s.length})}(e);if(!1!==n)return t.rules.push(n),!0;var i=function(e){var t=e.match(/^(?:\{([^}]+)\})? *((?: *[^,: ]+,? *?)+) *: *\((\d+) *, *(\d+) *, *(\d+)\)$/);if(null==t)return!1;var n=t[2].split(/,\s*|\s+/).map((function(e){return new c.default(e.trim())}));return new h.default({name:t[1],species:new Set(n),red:+t[3],green:+t[4],blue:+t[5]})}(e);if(!1!==i)return t.colour_map.add(i),!0;var s=function(e){return 1==(e.match(/=/g)||[]).length&&e.split("=").map((function(e){return e.trim()}))}(e);if(!1!==s){var a=o(s,2),r=a[0],u=a[1];return t.options.set(r,u),!0}return!1}function _(e){return e.split(/\s+|,/)}function m(e){var t,n=!1,i=new p.default,s=r(e);try{for(s.s();!(t=s.n()).done;){var a=t.value;if(""!=(a=a.trim().replace(/#.*/,"")))if(n){if("!END_INIT_STATE"==a){n=!1;continue}var o=_(a);i.initial_state.push(o)}else{if("!START_INIT_STATE"==a){n=!0;continue}f(a,i)}}}catch(u){s.e(u)}finally{s.f()}return i}t.parse_code=m,t.parse_import_files=function(e){return u(this,void 0,void 0,i.mark((function t(){var n,u,l,c,d,h,p,f,_,v,b,j,x,g,y,O,k;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return console.log("No input files"),t.abrupt("return",!1);case 3:n=function e(){a(this,e),this.data=[],this.imported=!1},u=new Map,l=r(e),t.prev=7,l.s();case 9:if((c=l.n()).done){t.next=18;break}return d=c.value,h=new n,t.next=14,d.text();case 14:h.data=t.sent.split("\n").map((function(e){return e.trim().replace(/#.*/,"")})),u.set(d.name,h);case 16:t.next=9;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(7),l.e(t.t0);case 23:return t.prev=23,l.f(),t.finish(23);case 26:p=r(u);try{for(p.s();!(f=p.n()).done;){_=o(f.value,2),_[0],v=_[1],b=r(v.data);try{for(b.s();!(j=b.n()).done;)j.value.match(/^!INCLUDE /)}catch(i){b.e(i)}finally{b.f()}}}catch(i){p.e(i)}finally{p.f()}x=[],g=r(u);try{for(g.s();!(y=g.n()).done;)O=o(y.value,2),O[0],(k=O[1]).imported||x.push.apply(x,s(k.data))}catch(i){g.e(i)}finally{g.f()}return t.abrupt("return",m(x));case 32:case"end":return t.stop()}}),t,null,[[7,20,23,26]])})))}},90:function(e,t){},91:function(e,t,n){}},[[134,1,2]]]);
//# sourceMappingURL=main.3066d4ca.chunk.js.map