(this.webpackJsonpsurface_crn_ide=this.webpackJsonpsurface_crn_ide||[]).push([[0],{104:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(54),s=n.n(i),u=n(21),o=n.n(u),c=n(26),l=n(55),d=n(2),h=n(3),p=n(6),f=n(5),m=n(4),v=n.n(m),_=(n(78),n(1)),j=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){return Object(_.jsx)("header",{className:"grid",children:Object(_.jsxs)("nav",{className:"grid",children:[Object(_.jsx)("h2",{className:"grid title",children:"Surface CRN Simulator"}),Object(_.jsx)("h4",{className:"grid simulator_options",children:"(sim options)"}),Object(_.jsx)("h4",{className:"grid simulator_controls",children:"(sim controls)"})]})})}}]),n}(a.a.Component),b=n(57),O=n(24),g=n(17),x=function(){function e(t,n){Object(d.a)(this,e),this.x=void 0,this.y=void 0,this.x=t,this.y=n}return Object(h.a)(e,[{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"subtract",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"scale",value:function(t){return new e(this.x*t,this.y*t)}}]),e}();x.origin=new x(0,0);var y=x,k=n(39),w=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;Object(d.a)(this,n),(r=t.call(this,e)).onCellDataChanged=function(e){r.setState({data:r.state.data.map((function(t,n){return n===e.rowIndex?Object(g.a)(Object(g.a)({},t),{},Object(O.a)({},e.fieldName,Object(g.a)(Object(g.a)({},t[e.fieldName]),{},{data:e.newData}))):t}))})};var a=e.model;return r.state={columns:r.createCols(a.current_state),data:r.createData(a.current_state),colour_map:a.colour_map,grid_type:a.grid_type,offset:y.origin},r}return Object(h.a)(n,[{key:"render",value:function(){return console.log("rendAll"),Object(_.jsxs)("div",{className:"panel state_panel",children:[Object(_.jsx)("h3",{children:" Initial State "}),Object(_.jsx)(k.ReactCanvasGrid,{columns:this.state.columns,data:this.state.data,rowHeight:20,onCellDataChanged:this.onCellDataChanged})]})}},{key:"updateColsAndData",value:function(e){this.setState({columns:this.createCols(e),data:this.createData(e)})}},{key:"createCols",value:function(e){var t=[],n=0;0!==e.length&&(n=e[0].length),t.push({fieldName:"addLeftCol",width:20});for(var r=0;r<n;r++)t.push({fieldName:r.toString(),width:20});return t.push({fieldName:"addRightCol",width:20}),t}},{key:"createData",value:function(e){for(var t=this,n=[],r=-1;r<=e.length;r++){var a={};if(-1!==r&&r!==e.length)for(var i=0;i<e[0].length;i++)a[i.toString()]={data:e[r][i],getText:function(e){return e||""},renderBackground:function(e,n,r,a){if(null!==r.data){var i=t.state.colour_map.find_colour(r.data);null==i&&(i=m.Colour.white()),e.fillStyle="rgb("+i.rgb().join(",")+")",e.fillRect(n.left,n.top,n.width,n.height)}},renderText:function(e,n,r){var a=Object(k.cellHasTextFunction)(r)?r.getText(r.data):r.text;if(a){var i=t.state.colour_map.find_colour(r.data);null==i&&(i=m.Colour.white());var s=i.rgb(),u=Object(b.a)(s,3),o=u[0],c=u[1],l=u[2];e.fillStyle=.299*o+.587*c+.114*l>186?"black":"white",e.fillText(a,n.left+2,n.top+10,n.width-4)}},editor:{serialise:function(e){return e||""},deserialise:function(e,t){return(e=e.trim()).match(/^\w+$/)?e:t}}};else if(0!=e.length)for(var s=0;s<e[0].length;s++)a[s.toString()]={data:null,text:"",renderBackground:function(){return 1}};a.addLeftCol={data:null,text:"",renderBackground:function(){return 1}},a.addRightCol={data:null,text:"",renderBackground:function(){return 1}},n.push(a)}return n}}]),n}(a.a.Component),S=n(25),C=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).model=void 0,r.model=e.model,r.state={rules_list:e.model.rules},r}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return Object(_.jsxs)("div",{className:"grid panel rules_panel",children:[Object(_.jsx)("h3",{className:"panel_header",children:" Transition Rules "}),Object(_.jsxs)("div",{id:"rule_container",children:[this.state.rules_list.map((function(t,n){return Object(_.jsx)(R,{rule:t,deleteRule:e.deleteRule(t).bind(e)},t.toString()+n.toString())})),Object(_.jsx)("div",{onClick:this.addRule.bind(this),children:" Add Rule "})]})]})}},{key:"deleteRule",value:function(e){var t=this;return function(n){t.model.remove_rule(e),t.setState({rules_list:t.model.rules})}}},{key:"addRule",value:function(){this.model.add_rule(),this.setState({rules_list:this.model.rules})}}]),n}(a.a.Component),R=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).rule=void 0,r.deleteRule=void 0,r.rule=e.rule,r.state={reactant0:e.rule.reactants[0].original_string,reactant1:e.rule.is_mono?"":e.rule.reactants[1].original_string,product0:e.rule.products[0].original_string,product1:e.rule.is_mono?"":e.rule.products[1].original_string,rate:e.rule.rate},r.deleteRule=e.deleteRule,r}return Object(h.a)(n,[{key:"render",value:function(){return Object(_.jsxs)("div",{className:"rulesRow grid",children:[Object(_.jsxs)("div",{children:[" ",Object(_.jsx)("input",{value:this.state.rate,type:"number",className:"rulesRate",onChange:this.updateRule.bind(this),min:"0",step:"0.1"})," "]}),Object(_.jsxs)("div",{children:[" ",Object(_.jsx)("input",{value:this.state.reactant0,className:"rulesReactant0",onChange:this.updateRule.bind(this)})," "]}),Object(_.jsx)("div",{children:" + "}),Object(_.jsxs)("div",{children:[" ",Object(_.jsx)("input",{value:this.state.reactant1,className:"rulesReactant1",onChange:this.updateRule.bind(this)})," "]}),Object(_.jsx)("div",{children:" => "}),Object(_.jsxs)("div",{children:[" ",Object(_.jsx)("input",{value:this.state.product0,className:"rulesProduct0",onChange:this.updateRule.bind(this)})," "]}),Object(_.jsx)("div",{children:" + "}),Object(_.jsxs)("div",{children:[" ",Object(_.jsx)("input",{value:this.state.product1,className:"rulesProduct1",onChange:this.updateRule.bind(this)})," "]}),Object(_.jsx)(S.b,{onClick:this.deleteRule})]})}},{key:"updateRule",value:function(e){var t=this.rule.reactants,n=this.rule.products,r=e.currentTarget.value;switch(e.target.className){case"rulesReactant0":t[0]=new m.Species_Matcher(r),this.rule.update({reactants:t}),this.setState({reactant0:r});break;case"rulesReactant1":t[1]=new m.Species_Matcher(r),this.rule.update({reactants:t}),this.setState({reactant1:r});break;case"rulesProduct0":n[0]=new m.Species_Matcher(r),this.rule.update({products:n}),this.setState({product0:r});break;case"rulesProduct1":n[1]=new m.Species_Matcher(r),this.rule.update({products:n}),this.setState({product1:r});break;case"rulesRate":n[1]=new m.Species_Matcher(r),this.rule.update({rate:+r}),this.setState({rate:+r})}}}]),n}(a.a.Component),N=n(23),I=n(56),T=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).model=void 0,r.refreshInitState=void 0,r.model=e.model,r.refreshInitState=e.refreshInitState,r.state={colour_map:r.model.colour_map},r}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return Object(_.jsxs)("div",{className:"grid panel colour_panel",children:[Object(_.jsx)("h3",{children:" Colour Mapping "}),Object(_.jsx)("div",{id:"colour_container",children:Object(c.a)(this.state.colour_map.values()).map((function(t){return Object(_.jsx)(M,{colour:t,refreshInitState:e.refreshInitState})}))})]})}}]),n}(a.a.Component),M=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).colour=void 0,r.pickerRef=null,r.refreshInitState=void 0,r.mouseDownInElement=!1,r.colour=e.colour,r.refreshInitState=e.refreshInitState,r.state={colour:e.colour.hex(),isOpen:!1,species:e.colour.species,name:e.colour.name,showList:!1},r.handleClickOutside=r.handleClickOutside.bind(Object(N.a)(r)),r}return Object(h.a)(n,[{key:"handleClickOutside",value:function(e){this.mouseDownInElement||!this.pickerRef||this.pickerRef.contains(e.target)||this.setState({isOpen:!1})}},{key:"handleDownClick",value:function(e){this.mouseDownInElement=!this.pickerRef||this.pickerRef.contains(e.target)}},{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handleDownClick.bind(this)),document.addEventListener("mouseup",this.handleClickOutside.bind(this))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleDownClick),document.removeEventListener("mouseup",this.handleClickOutside)}},{key:"render",value:function(){var e=this;return Object(_.jsxs)("div",{children:[Object(_.jsxs)("div",{className:"picker",children:[Object(_.jsx)("div",{className:"swatch",style:{backgroundColor:this.colour.hex()},onClick:function(){return!e.state.isOpen&&e.setState({isOpen:!e.state.isOpen})}}),Object(_.jsx)("input",{value:this.state.name,onChange:function(t){var n=t.currentTarget.value;e.setState({name:n}),e.colour.name=n}}),Object(_.jsx)(S.a,{size:25,style:{cursor:"pointer"},onClick:function(t){e.setState({showList:!e.state.showList})}})]}),this.state.isOpen&&Object(_.jsx)("div",{className:"popover",ref:function(t){return e.pickerRef=t},children:Object(_.jsx)(I.a,{color:this.colour.hex(),onChange:function(t){e.setState({colour:t}),e.updateColour(t)}})}),this.state.showList&&Object(_.jsxs)("div",{className:"flexBox",children:[this.colour.species.map((function(t){return Object(_.jsxs)("div",{children:[" ",Object(_.jsx)("input",{value:t.original_string,className:"",onChange:e.updateSpecies(t).bind(e)},t.original_string)," "]})})),Object(_.jsx)("hr",{})]})]})}},{key:"updateColour",value:function(e){this.colour.update_colour(m.Colour.hex2rgb(e)),this.refreshInitState()}},{key:"updateSpecies",value:function(e){var t=this;return function(n){e.update_matcher(n.target.value),t.setState({species:t.colour.species}),t.refreshInitState()}}}]),n}(a.a.Component),E=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){return Object(d.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"render",value:function(){var e=this.props.import_code;return Object(_.jsxs)("div",{className:"grid panel import_export_panel",children:[Object(_.jsx)("h3",{children:" Import/Export "}),Object(_.jsxs)("div",{children:[Object(_.jsx)("input",{type:"file",id:"import_input",multiple:!0}),Object(_.jsx)("button",{type:"submit",id:"import_submit",onClick:e,children:" Import "})]}),Object(_.jsx)("div",{children:Object(_.jsx)("button",{id:"export",onClick:this.props.export_code,children:" Export "})})]})}}]),n}(a.a.Component),D=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).initial_state_component=null,r.transition_state_component=null,r.colour_map_component=null,r.state={model:new v.a({current_state:Array(5).fill(Array(5).fill("I"))})},r}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return Object(_.jsxs)("div",{className:"main_grid grid",children:[Object(_.jsx)(j,{}),Object(_.jsx)(w,{model:this.state.model,ref:function(t){return e.initial_state_component=t}}),Object(_.jsx)(T,{ref:function(t){return e.colour_map_component=t},model:this.state.model,refreshInitState:this.refreshInitState.bind(this)}),Object(_.jsx)(C,{ref:function(t){return e.transition_state_component=t},model:this.state.model}),Object(_.jsx)(E,{export_code:this.export_code.bind(this),import_code:this.import_code.bind(this)})]})}},{key:"import_code",value:function(){var e=Object(l.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=document.getElementById("import_input").files)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,v.a.parser.parse_import_files(Object(c.a)(t));case 5:!1===(n=e.sent)||(this.setState({model:n}),this.update_page());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"export_code",value:function(){var e=this.state.model.export(),t=new Blob([e],{type:"text/plain"}),n=document.createElement("a");n.download="surface_crn_export.txt",n.href=(window.webkitURL||window.URL).createObjectURL(t),n.dataset.downloadurl=["text/plain",n.download,n.href].join(":"),n.click()}},{key:"update_page",value:function(){this.transition_state_component.model=this.state.model,this.transition_state_component.setState({rules_list:this.state.model.rules}),this.colour_map_component.model=this.state.model,this.colour_map_component.setState({colour_map:this.state.model.colour_map}),this.update_init_state(this.state.model.current_state,this.state.model.colour_map,this.state.model.grid_type)}},{key:"update_init_state",value:function(e,t,n){this.initial_state_component.setState({current_state:e,colour_map:t,grid_type:n}),this.initial_state_component.updateColsAndData(e)}},{key:"refreshInitState",value:function(){this.update_init_state(this.state.model.current_state,this.state.model.colour_map,this.state.model.grid_type)}}]),n}(a.a.Component);s.a.render(Object(_.jsxs)(a.a.StrictMode,{children:[Object(_.jsx)("title",{children:" Surface CRN Simulator "}),Object(_.jsx)(D,{})]}),document.getElementById("root"))},30:function(e,t,n){"use strict";var r=n(9),a=n(11);Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){r(this,e),this.original_string="",this.matcher="",this.update_matcher(t)}return a(e,[{key:"includes",value:function(e){return null!==new RegExp(this.matcher).exec(e)}},{key:"is_pure",value:function(){return null===this.original_string.match(/^\w+$/)}},{key:"toString",value:function(){return this.original_string}},{key:"update_matcher",value:function(e){if(this.original_string=e,null!==e.match(/\\(\d|\(\d+\))/))throw Error();e=e.replace(/\\\((\d+)\)/g,"(?:\\$1)"),this.matcher="^(?:"+e+")$"}}]),e}();t.default=i},4:function(e,t,n){"use strict";var r=n(28),a=n(9),i=n(11),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Colour=t.Colour_Map=t.Transition_Rule=t.Species_Matcher=void 0;var u=s(n(30));t.Species_Matcher=u.default;var o=s(n(41));t.Transition_Rule=o.default;var c=s(n(66));t.Colour_Map=c.default;var l=s(n(47));t.Colour=l.default;var d=n(77),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.current_state=[],this.rules=[],this.colour_map=new c.default,this.options=new Map,this.grid_type="square",Object.assign(this,t)}return i(e,[{key:"remove_rule",value:function(e){this.rules.splice(this.rules.indexOf(e),1)}},{key:"add_rule",value:function(){this.rules.push(o.default.blankRule())}},{key:"export",value:function(){var e=[];return e.push("!START_TRANSITION_RULES"),e.push.apply(e,r(this.rules.map((function(e){return e.toString()})))),e.push("!END_TRANSITION_RULES"),e.push(["!START_COLORMAP"]),e.push.apply(e,r(this.colour_map.export())),e.push(["!END_COLORMAP"]),e.push(["!START_INIT_STATE"]),e.push.apply(e,r(this.current_state.map((function(e){return e.join(" ")})))),e.push(["!END_INIT_STATE"]),e.join("\n")}}]),e}();t.default=h,h.parser={parse_import_files:d.parse_import_files,parse_code:d.parse_code}},41:function(e,t,n){"use strict";var r=n(9),a=n(11),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(n(30)),u=function(){function e(t){r(this,e),this.is_mono=!0,this.reactants=[],this.products=[],this.rate=1,this.update(t)}return a(e,[{key:"toString",value:function(){return"("+this.rate.toString()+") "+[this.reactants,this.products].map((function(e){return e.map((function(e){return e.toString()})).join(" + ")})).join(" -> ")}},{key:"update",value:function(e){Object.assign(this,e),this.is_mono=this.reactants.length<2&&this.products.length<2}}],[{key:"blankRule",value:function(){return new e({is_mono:!0,reactants:[new s.default("")],products:[new s.default("")]})}}]),e}();t.default=u},47:function(e,t,n){"use strict";var r=n(9),a=n(11);Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){r(this,e),this.red=0,this.green=0,this.blue=0,this.species=[],this.name="",this.update_colour(t)}return a(e,[{key:"rgb",value:function(){return[this.red,this.green,this.blue]}},{key:"hex",value:function(){return"#"+this.rgb().map((function(e){return("0"+e.toString(16)).slice(-2)})).join("")}},{key:"update_colour",value:function(e){Object.assign(this,e)}}],[{key:"white",value:function(){return new e({red:256,green:256,blue:256})}},{key:"hex2rgb",value:function(e){var t=(e=e.replace(/^#/,"")).match(/^([A-Fa-f\d]{2})([A-Fa-f\d]{2})([A-Fa-f\d]{2})$/);return t?{red:parseInt(t[1],16),green:parseInt(t[2],16),blue:parseInt(t[3],16)}:{red:256,green:256,blue:256}}}]),e}();t.default=i},66:function(e,t,n){"use strict";var r=n(28),a=n(42),i=n(43),s=n(9),u=n(11),o=n(44),c=n(70),l=n(71),d=n(74);Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){c(n,e);var t=l(n);function n(e){var r;return s(this,n),r=t.call(this),Object.assign(o(r),e),r}return u(n,[{key:"find_colour",value:function(e){var t,n=i(this);try{for(n.s();!(t=n.n()).done;){var r=a(t.value,2),s=(r[0],r[1]);if(s.species.some((function(t){return t.includes(e)})))return s}}catch(u){n.e(u)}finally{n.f()}return null}},{key:"export",value:function(){return r(this.values()).map((function(e){return"{"+e.name+"} "+e.species.map((function(e){return e.toString()})).join(" ")+" : ("+e.rgb().join(",")+")"}))}}]),n}(d(Map));t.default=h},77:function(e,t,n){"use strict";var r=n(21),a=n(9),i=n(43),s=n(28),u=n(42),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{o(r.next(e))}catch(t){i(t)}}function u(e){try{o(r.throw(e))}catch(t){i(t)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}o((r=r.apply(e,t||[])).next())}))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parse_import_files=t.parse_code=void 0;var l=c(n(30)),d=c(n(41)),h=c(n(47)),p=c(n(4));function f(e,t){var n=function(e){if(1!=(e.match(/->/g)||[]).length)return!1;var t=1,n=(e=e.replace(/\((\d+)\)/,(function(e,n){return t=+n,""}))).split("->").map((function(e){return e.split("+").map((function(e){return new l.default(e.trim())}))})),r=u(n,2),a=r[0],i=r[1];return!(a.length!=i.length||a.length>2||0==a.length)&&new d.default({reactants:a,products:i,rate:t,is_mono:1==a.length})}(e);if(!1!==n)return t.rules.push(n),!0;var r,a=function(e){var t=e.match(/^(?:\{([^}]+)\})? *((?: *[^,: ]+,? *)+) *: *\((\d+) *, *(\d+) *, *(\d+)\)$/);if(null==t)return!1;var n=t[2].split(/,\s*|\s+/).map((function(e){return new l.default(e.trim())}));return[t[1],new h.default({name:t[1],species:n,red:+t[3],green:+t[4],blue:+t[5]})]}(e);if(!1!==a)return(r=t.colour_map).set.apply(r,s(a)),!0;var i=function(e){return 1==(e.match(/=/g)||[]).length&&e.split("=").map((function(e){return e.trim()}))}(e);if(!1!==i){var o=u(i,2),c=o[0],p=o[1];return t.options.set(c,p),!0}return!1}function m(e){return e.split(/\s+|,/)}function v(e){var t,n=!1,r=new p.default,a=i(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;if(""!=(s=s.trim().replace(/#.*/,"")))if(n){if("!END_INIT_STATE"==s){n=!1;continue}var u=m(s);r.current_state.push(u)}else{if("!START_INIT_STATE"==s){n=!0;continue}f(s,r)}}}catch(o){a.e(o)}finally{a.f()}return r}t.parse_code=v,t.parse_import_files=function(e){return o(this,void 0,void 0,r.mark((function t(){var n,o,c,l,d,h,p,f,m,_,j,b,O,g,x,y,k;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return console.log("No input files"),t.abrupt("return",!1);case 3:n=function e(){a(this,e),this.data=[],this.imported=!1},o=new Map,c=i(e),t.prev=7,c.s();case 9:if((l=c.n()).done){t.next=18;break}return d=l.value,h=new n,t.next=14,d.text();case 14:h.data=t.sent.split("\n").map((function(e){return e.trim().replace(/#.*/,"")})),o.set(d.name,h);case 16:t.next=9;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(7),c.e(t.t0);case 23:return t.prev=23,c.f(),t.finish(23);case 26:p=i(o);try{for(p.s();!(f=p.n()).done;){m=u(f.value,2),m[0],_=m[1],j=i(_.data);try{for(j.s();!(b=j.n()).done;)b.value.match(/^!INCLUDE /)}catch(r){j.e(r)}finally{j.f()}}}catch(r){p.e(r)}finally{p.f()}O=[],g=i(o);try{for(g.s();!(x=g.n()).done;)y=u(x.value,2),y[0],(k=y[1]).imported||O.push.apply(O,s(k.data))}catch(r){g.e(r)}finally{g.f()}return t.abrupt("return",v(O));case 32:case"end":return t.stop()}}),t,null,[[7,20,23,26]])})))}},78:function(e,t,n){}},[[104,1,2]]]);
//# sourceMappingURL=main.04a3956a.chunk.js.map