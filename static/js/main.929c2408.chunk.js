(this.webpackJsonpsurface_crn_ide=this.webpackJsonpsurface_crn_ide||[]).push([[0],{131:function(e,t,s){"use strict";var i=s(43),a=s(47),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(s(172)),l=function(){function e(t){i(this,e),this.original_string="",this.matched=[],this.update_matched(t)}return a(e,[{key:"includes",value:function(e){return this.matched.includes(e)}},{key:"is_pure",value:function(){return null===this.original_string.match(/^\w+$/)}},{key:"toString",value:function(){return this.original_string}},{key:"update_matched",value:function(e){this.original_string=e,this.matched=r.default.decompose(e)}}]),e}();t.default=l},152:function(e,t,s){"use strict";var i=s(43),a=s(47),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(s(131)),l=function(){function e(t){i(this,e),this.red=0,this.green=0,this.blue=0,this.species=new Set,this.name="",this.hexString="","string"===typeof t&&(t=e.hex2rgb(t)),this.update_colour(t)}return a(e,[{key:"rgb",value:function(){return[this.red,this.green,this.blue]}},{key:"hex",value:function(){return this.hexString}},{key:"update_colour",value:function(e){Object.assign(this,e),this.hexString="#"+this.rgb().map((function(e){return("0"+e.toString(16)).slice(-2)})).join("")}},{key:"add_matcher",value:function(e){this.species.add(new r.default(e))}},{key:"delete_matcher",value:function(e){this.species.delete(e)}}],[{key:"white",value:function(){return new e({red:256,green:256,blue:256})}},{key:"hex2rgb",value:function(e){var t=(e=e.replace(/^#/,"")).match(/^([A-Fa-f\d]{2})([A-Fa-f\d]{2})([A-Fa-f\d]{2})$/);return t?{red:parseInt(t[1],16),green:parseInt(t[2],16),blue:parseInt(t[3],16)}:{red:256,green:256,blue:256}}}]),e}();t.default=l},172:function(e,t,s){"use strict";var i=s(98),a=s(43),n=s(47),r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=r(s(251)),o=function(){function e(){a(this,e)}return n(e,null,[{key:"decompose",value:function(e){var t,s=[],a=i(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;if("([{".includes(n))s.push(n);else if(")]}".includes(n)&&!"() {} []".includes(s.pop()+n))throw"Unbalanced brackets"}}catch(r){a.e(r)}finally{a.f()}if(0!==s.length)throw"Unbalanced brackets";return this.parse(e)}},{key:"parse",value:function(e){var t,s=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NaN;if(""===e)return[""];if(t=e.match(/^((?:\w|\\\d+|\\<\d+>))\?(.*)$/))return this.parse(t[2],i,a).map((function(e){return[t[1]+e,e]})).flat();if(t=e.match(/^((?:\w|\\\d+|\\<\d+>| \+ | \-> )+)(?!\?)(.*)$/))return this.parse(t[2],i,a).map((function(e){return t[1]+e}));if("{"===e[0]){var n=(d=l.default.matchRecursive(e,"\\{","\\}\\??","g",{valueNames:["between","left","match","right"]})).slice(3).map((function(e){return e.value})).join("");if(isNaN(a)){var r=0,o=d[1].value.match(/^\w+$/)?d[1].value.split("").map((function(e){return[e]})):d[1].value.split("|").map((function(e){return s.parse(e,i,r++)}));return r=0,o.map((function(e){var t=s.parse(n,i,r++),a=t.map((function(t){return e.map((function(e){return e+t}))})).flat();return"}?"===d[2].value&&(a=a.concat(t)),a})).flat()}var u=d[1].value.match(/^\w+$/)?d[1].value.split(""):d[1].value.split("|").map((function(e){return s.parse(e,i,a)})).flat();if(a>u.length)throw"Uneven_Curly_Groups";var c=this.parse(n,i,a),h=c.map((function(e){return s.parse(u[a],i,a)+e}));return"}?"===d[2].value&&(h=h.concat(c)),h}if("["===e[0]){u=(d=l.default.matchRecursive(e,"\\[","\\]\\??","g",{valueNames:["between","left","match","right"]}))[1].value.match(/^\w+$/)?d[1].value.split(""):d[1].value.split("|").map((function(e){return s.parse(e,i,a)})).flat();return"]?"===d[2].value&&u.push(""),this.parse(d.slice(3).map((function(e){return e.value})).join(""),i,a).map((function(e){return u.map((function(t){return t+e}))})).flat()}if("("===e[0]){var d;u=(d=l.default.matchRecursive(e,"\\(","\\)\\??","g",{valueNames:["between","left","match","right"]}))[1].value.match(/^\w+$/)?d[1].value.split(""):d[1].value.split("|").map((function(e){return s.parse(e,i,a)})).flat();return")?"===d[2].value&&u.push(""),this.parse(d.slice(3).map((function(e){return e.value})).join(""),i+1,a).map((function(e){return u.map((function(t){return t+e.replace(new RegExp("\\\\"+i+"|\\\\<"+i+">","g"),t)}))})).flat()}throw"Unknown Character "+e[0]}}]),e}();t.default=o},207:function(e,t,s){"use strict";var i=s(43),a=s(47),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(s(172)),l=function(){function e(t){i(this,e),this.is_mono=!0,this.reactants=[],this.products=[],this.decomposed=[],this.rate=1,this.update(t)}return a(e,[{key:"toString",value:function(){return"("+this.rate.toString()+") "+[this.reactants,this.products].map((function(e){return e.map((function(e){return e.toString()})).join(" + ")})).join(" -> ")}},{key:"update",value:function(e){if(Object.assign(this,e),this.reactants.length!==this.products.length)throw"Reactants and products are not equal length";this.is_mono=this.reactants.length<2&&this.products.length<2,this.decomposed=r.default.decompose(this.reactants.join(" + ")+" -> "+this.products.join(" + ")).map((function(e){return e.split(/ \+ | \-> /)})).filter((function(e){return e.every((function(e){return""!==e}))}))}},{key:"matches",value:function(e,t){return this.is_mono===(void 0!==t)?[]:this.is_mono?this.decomposed.filter((function(t){return t[0]===e})).map((function(e){return[e[1]]})):this.decomposed.filter((function(s){return s[0]===e&&s[1]===t})).map((function(e){return[e[2],e[3]]}))}}],[{key:"blankRule",value:function(){return new e({is_mono:!0,reactants:[""],products:[""]})}}]),e}();t.default=l},395:function(e,t,s){"use strict";var i=s(98),a=s(130),n=s(43),r=s(47),l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=l(s(152)),u=function(){function e(t){n(this,e),this.colours=new Set,this.cache=new Map,this.example_colours=["#ffffff","#000000","#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#42d4f4","#f032e6","#bfef45","#fabed4","#469990","#dcbeff","#9A6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#a9a9a9"].map((function(e){return new o.default(e)})),this.temp_colours=new Map,t&&(this.colours=t)}return r(e,[{key:"equals",value:function(e){var t=this;return!(!a(e.colours).filter((function(e){return!t.colours.has(e)}))&&!a(this.colours).filter((function(t){return!e.colours.has(t)})))}},{key:"find_colour",value:function(e){var t=this.cache.get(e);if(void 0===t){var s,n=i(this.colours);try{for(n.s();!(s=n.n()).done;){var r=s.value;if(a(r.species.values()).some((function(t){return t.includes(e)}))){t=r;break}}}catch(l){n.e(l)}finally{n.f()}void 0===t&&void 0===(t=this.temp_colours.get(e))&&(void 0===(t=this.new_colour())&&(t=new o.default("#FFFFFF")),this.add_temp(e,t),this.cache.set(e,t))}return t}},{key:"export",value:function(){return a(this.colours.values()).map((function(e){return"{"+e.name+"} "+a(e.species.values()).map((function(e){return e.toString()})).join(" ")+" : ("+e.rgb().join(",")+")"}))}},{key:"new_colour",value:function(){var e=this;this.cache.clear();var t=this.example_colours.find((function(t){return void 0===[].concat(a(e.temp_colours.values()),a(e.colours.values())).find((function(e){return e.hex()===t.hex()}))}));return void 0===t?new o.default("#000000"):t}},{key:"add",value:function(e){this.cache.clear(),this.colours.add(e)}},{key:"delete",value:function(e){this.cache.clear(),this.colours.delete(e)}},{key:"add_temp",value:function(e,t){this.cache.clear(),this.temp_colours.set(e,t)}},{key:"clear_temp",value:function(){this.cache.clear(),this.temp_colours.clear()}}]),e}();t.default=u},396:function(e,t,s){"use strict";var i=s(43),a=s(47);Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(t,s){i(this,e),this.old_cells=[],this.new_cells=[],this.new_transitions=null,this.update_time=t,this.execution_time=s}return a(e,[{key:"add_old_cell",value:function(e,t,s){this.old_cells.push([e,t,s])}},{key:"add_new_cell",value:function(e,t,s){this.new_cells.push([e,t,s])}},{key:"add_future_transitions",value:function(e){this.new_transitions=e}}]),e}();t.default=n},397:function(e,t,s){"use strict";var i=s(114),a=s(130),n=s(43),r=s(398),l=s(98),o=s(170),u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parse_import_files=t.parse_code=void 0;var c=u(s(131)),h=u(s(207)),d=u(s(152)),p=u(s(68));function f(e,t){var s=function(e){if(1!=(e.match(/->/g)||[]).length)return!1;var t=1,s=(e=e.replace(/\((\d*(?:\.\d+)?)\)/,(function(e,s){return t=+s,""}))).split("->").map((function(e){return e.split("+").map((function(e){return e.trim()}))})),i=o(s,2),a=i[0],n=i[1];return!(a.length!=n.length||a.length>2||0==a.length)&&new h.default({reactants:a,products:n,rate:t,is_mono:1==a.length})}(e);if(!1!==s)return t.rules.push(s),!0;var i=function(e){var t=e.match(/^(?:\{([^}]+)\})? *((?: *[^,: ]+,? *?)+) *: *\((\d+) *, *(\d+) *, *(\d+)\)$/);if(null==t)return!1;var s=t[2].split(/,\s*|\s+/).map((function(e){return new c.default(e.trim())}));return new d.default({name:t[1]||t[2],species:new Set(s),red:+t[3],green:+t[4],blue:+t[5]})}(e);if(!1!==i)return t.colour_map.add(i),!0;var a=function(e){return 1==(e.match(/=/g)||[]).length&&e.split("=").map((function(e){return e.trim()}))}(e);if(!1!==a){var n=o(a,2),r=n[0],l=n[1];return t.set_option(r,l),!0}return!1}function m(e){return e.split(/\s+|,/)}function v(e){var t,s=!1,i=new p.default,a=l(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(""!=(n=n.trim().replace(/#.*/,"")))if(s){if("!END_INIT_STATE"==n){s=!1;continue}var r=m(n);i.initial_state.push(r)}else{if("!START_INIT_STATE"==n){s=!0;continue}f(n,i)}}}catch(o){a.e(o)}finally{a.f()}return i}function _(){return(_=r(i.mark((function e(t){var s,r,u,c,h,d,p,f,m,_,b,x,y,j,g,O,w;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:s=function e(){n(this,e),this.data=[],this.imported=!1},r=new Map,u=l(t),e.prev=6,u.s();case 8:if((c=u.n()).done){e.next=17;break}return h=c.value,d=new s,e.next=13,h.text();case 13:d.data=e.sent.split("\n").map((function(e){return e.trim().replace(/#.*/,"")})),r.set(h.name,d);case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(6),u.e(e.t0);case 22:return e.prev=22,u.f(),e.finish(22);case 25:p=l(r);try{for(p.s();!(f=p.n()).done;){m=o(f.value,2),m[0],_=m[1],b=l(_.data);try{for(b.s();!(x=b.n()).done;)x.value.match(/^!INCLUDE /)}catch(i){b.e(i)}finally{b.f()}}}catch(i){p.e(i)}finally{p.f()}y=[],j=l(r);try{for(j.s();!(g=j.n()).done;)O=o(g.value,2),O[0],(w=O[1]).imported||y.push.apply(y,a(w.data))}catch(i){j.e(i)}finally{j.f()}return e.abrupt("return",v(y));case 31:case"end":return e.stop()}}),e,null,[[6,19,22,25]])})))).apply(this,arguments)}t.parse_code=v,t.parse_import_files=function(e){return _.apply(this,arguments)}},402:function(e,t,s){},414:function(e,t,s){"use strict";s.r(t);var i=s(0),a=s.n(i),n=s(64),r=s.n(n),l=s(114),o=s.n(l),u=s(16),c=s(209),h=s(14),d=s(15),p=s(19),f=s(18),m=s(68),v=s.n(m),_=(s(402),s(215)),b=s.n(_),x=s(214),y=s.n(x),j=s(216),g=s.n(j),O=s(213),w=s.n(O),k=s(217),S=s.n(k),C=s(212),R=s.n(C),P=s(211),M=s.n(P),z=s(478),E=s(477),D=s(472),I=s(1),T=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(){var e;Object(h.a)(this,s);for(var i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))).stopButton=null,e.fastBackward=null,e.stepBackward=null,e.playButton=null,e.stepForward=null,e.fastForward=null,e}return Object(d.a)(s,[{key:"render",value:function(){return Object(I.jsxs)(D.a,{item:!0,container:!0,xs:12,children:[Object(I.jsx)(D.a,{item:!0,xs:12,sm:8,children:Object(I.jsx)(E.a,{variant:"h3",className:"grid title",children:"Surface CRN Simulator"})}),Object(I.jsxs)(D.a,{item:!0,xs:12,sm:4,children:[Object(I.jsxs)(z.a,{onClick:this.props.stopPressed,children:[" ",Object(I.jsx)(M.a,{sx:{fontSize:40}})," "]}),Object(I.jsxs)(z.a,{onClick:this.props.fastBackwardPressed,children:[" ",Object(I.jsx)(R.a,{sx:{fontSize:40}})," "]}),Object(I.jsxs)(z.a,{onClick:this.props.stepBackPressed,children:[" ",Object(I.jsx)(w.a,{sx:{fontSize:40}})," "]}),Object(I.jsx)(z.a,{onClick:this.props.playPressed,children:this.props.simPlaying?Object(I.jsx)(y.a,{sx:{fontSize:40}}):Object(I.jsx)(b.a,{sx:{fontSize:40}})}),Object(I.jsxs)(z.a,{onClick:this.props.stepForwardPressed,children:[" ",Object(I.jsx)(g.a,{sx:{fontSize:40}})," "]}),Object(I.jsxs)(z.a,{onClick:this.props.fastForwardPressed,children:[" ",Object(I.jsx)(S.a,{sx:{fontSize:40}})," "]})]})]})}}]),s}(a.a.Component),N=s(52),A=s(13),F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(h.a)(this,e),this.x=void 0,this.y=void 0,this.x=t,this.y=s}return Object(d.a)(e,[{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"subtract",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"multiply",value:function(t){return new e(this.x*t.x,this.y*t.y)}},{key:"scale",value:function(t){return new e(this.x*t,this.y*t)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"magnitude",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}}]),e}();F.origin=new F(0,0);var q=F,L=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).canvas=null,i.mouseDown=!1,i.mousePosition=null,i.mouseMoved=!1,i.state={data:i.createData(e.current_state),offset:q.origin,selected_cells:[],sim_time:e.simulation?0:null},i}return Object(d.a)(s,[{key:"render",value:function(){var e=this;return Object(I.jsx)("canvas",{ref:function(t){return e.canvas=t}})}},{key:"componentDidMount",value:function(){this.canvas.addEventListener("wheel",this.scrollZoom.bind(this),{passive:!1}),this.canvas.addEventListener("mousedown",this.mouseEvents.bind(this)),this.canvas.addEventListener("mouseup",this.mouseEvents.bind(this)),this.canvas.addEventListener("mousemove",this.mouseEvents.bind(this)),this.canvas.addEventListener("dblclick",this.mouseEvents.bind(this)),this.canvas.addEventListener("mouseenter",this.mouseEvents.bind(this)),this.canvas.addEventListener("mouseleave",this.mouseEvents.bind(this)),this.draw()}},{key:"hexCoord",value:function(e,t){var s,i=1.125*this.props.size,a=this.props.size*Math.sin(2*Math.PI/6)*2*.75,n=.375*this.props.size,r=n/(a/2),l=Math.floor((t+n/2)/i),o=1===(1&l),u=t+n/2-l*i,c=e-(s=Math.floor(e/a-(o?.5:0)))*a-(o?a/2:0);return u<-r*c+n?(l--,o||s--):u<r*c-n&&(l--,o&&s++),[s,l]}},{key:"mouseEvents",value:function(e){switch(e.type){case"mousedown":this.mouseDown=!0,this.mousePosition=new q(e.x,e.y);break;case"mouseenter":case"mouseleave":case"mouseup":if(this.mouseDown&&!this.mouseMoved){var t=this.canvas.getBoundingClientRect(),s=e.x-this.state.offset.x-t.x,i=e.y-this.state.offset.y-t.y;if("square"===this.props.geometry)this.setState({selected_cells:[new q(Math.floor(s/this.props.size),Math.floor(i/this.props.size))]});else if("hex"===this.props.geometry){var a=this.hexCoord(s,i),n=Object(A.a)(a,2),r=n[0],l=n[1];this.setState({selected_cells:[new q(Math.floor(r),Math.floor(l))]})}}this.mouseDown=!1,this.mouseMoved=!1,this.mousePosition=null;break;case"mousemove":if(this.mouseDown){var o=this.mousePosition.subtract(new q(e.x,e.y));(this.mouseMoved||o.magnitude()>5)&&(this.mousePosition=new q(e.x,e.y),this.mouseMoved=!0,this.setState({offset:this.state.offset.subtract(o)}))}}return e.preventDefault(),!1}},{key:"componentDidUpdate",value:function(e,t){if(e.model!==this.props.model||e.geometry!==this.props.geometry||!t.offset.equals(this.state.offset)||e.size!==this.props.size||null!==t.sim_time&&t.sim_time>0&&0===this.state.sim_time)this.draw();else if(e.current_state!==this.props.current_state&&this.setState({data:this.createData(this.props.current_state)}),t!==this.state){if(t.selected_cells!==this.state.selected_cells){var s,i=this.state.selected_cells.length<1?"":null,a=Object(N.a)(this.state.selected_cells);try{for(a.s();!(s=a.n()).done;){var n,r,l=s.value,o=((null===(n=this.state.data)||void 0===n||null===(r=n[l.y])||void 0===r?void 0:r[l.x])||[""])[0];null===i&&(i=o),i!==o&&(i="")}}catch(w){a.e(w)}finally{a.f()}this.props.selectedCells(this.state.selected_cells,i)}var u=this.canvas.getContext("2d");if(null===u||!(u instanceof CanvasRenderingContext2D))return;var c=u;if(t.data!==this.state.data){var h,d=Object(N.a)(this.state.data.entries());try{for(d.s();!(h=d.n()).done;){var p,f=Object(A.a)(h.value,2),m=f[0],v=f[1],_=Object(N.a)(v.entries());try{for(_.s();!(p=_.n()).done;){var b,x,y=Object(A.a)(p.value,2),j=y[0],g=y[1],O=null===(b=t.data)||void 0===b||null===(x=b[m])||void 0===x?void 0:x[j];void 0!==O&&O[0]===g[0]&&O[1].hex()===g[1].hex()||this.drawCell(c,j,m,g)&&0}}catch(w){_.e(w)}finally{_.f()}}}catch(w){d.e(w)}finally{d.f()}}this.addExtraDetail(c,t)}}},{key:"scrollZoom",value:function(e){var t=1;e.deltaY<0?t=this.props.zoom(!0):e.deltaY>0&&(t=this.props.zoom(!1)),e.preventDefault();var s=this.canvas.getBoundingClientRect(),i=(this.state.offset.x-e.x+s.x)/t+e.x-s.x,a=(this.state.offset.y-e.y+s.y)/t+e.y-s.y;this.setState({offset:new q(i,a)})}},{key:"draw",value:function(){if(null!==this.canvas){var e=this.canvas.parentNode.getBoundingClientRect();this.canvas.width=Math.floor(e.width*window.devicePixelRatio),this.canvas.height=Math.floor(e.height*window.devicePixelRatio),this.canvas.style.width=Math.floor(e.width)+"px",this.canvas.style.height=Math.floor(e.height)+"px";var t=this.canvas.getContext("2d");if(null!==t&&t instanceof CanvasRenderingContext2D){var s=t;s.clearRect(0,0,s.canvas.width,s.canvas.height),s.scale(window.devicePixelRatio,window.devicePixelRatio),s.translate(this.state.offset.x,this.state.offset.y);var i,a=this.createData(this.props.current_state),n=Object(N.a)(a.entries());try{for(n.s();!(i=n.n()).done;){var r,l=Object(A.a)(i.value,2),o=l[0],u=l[1],c=Object(N.a)(u.entries());try{for(c.s();!(r=c.n()).done;){var h=Object(A.a)(r.value,2),d=h[0],p=h[1];this.drawCell(s,d,o,p)}}catch(f){c.e(f)}finally{c.f()}}}catch(f){n.e(f)}finally{n.f()}this.addExtraDetail(s)}}}},{key:"addExtraDetail",value:function(e,t){if(null!==this.state.sim_time){e.fillStyle="#FFFFFF";var s=e.canvas.width/window.devicePixelRatio-80-this.state.offset.x,i=e.canvas.height/window.devicePixelRatio-30-this.state.offset.y;e.fillRect(s,i,80,30),e.fillStyle="#000000",e.textAlign="left",e.textBaseline="middle",e.font="15px Arial",e.fillText("T: "+this.state.sim_time.toFixed(2),s+4,i+15,80)}for(var a=0,n=[t,this.state];a<n.length;a++){var r=n[a];if(void 0!==r){var l,o=Object(N.a)(r.selected_cells);try{for(o.s();!(l=o.n()).done;){var u,c,h=l.value;if(e.lineWidth=1,e.strokeStyle="rgba(0,204,256,0.3)",e.fillStyle=e.strokeStyle,"square"===this.props.geometry)if(r===t)this.drawCell(e,h.x,h.y,null===(u=this.state.data)||void 0===u||null===(c=u[h.y])||void 0===c?void 0:c[h.x]);else e.fillRect(h.x*this.props.size,h.y*this.props.size,this.props.size,this.props.size);else if("hex"===this.props.geometry)if(r===t){var d,p;this.drawCell(e,h.x,h.y,null===(d=this.state.data)||void 0===d||null===(p=d[h.y])||void 0===p?void 0:p[h.x])}else{var f=(h.x+(1&h.y)/2+.5)*this.props.size*Math.sin(2*Math.PI/6)*2*.75,m=(h.y+.5)*this.props.size*.75*2*.75;e.beginPath();for(var v=0;v<6;v++)e.lineTo(f+this.props.size*Math.sin(2*Math.PI/6*v)*.75,m+this.props.size*Math.cos(2*Math.PI/6*v)*.75);e.closePath(),e.fill()}}}catch(_){o.e(_)}finally{o.f()}}}}},{key:"createData",value:function(e){this.props.model.colour_map.clear_temp();var t,s=[],i=Object(N.a)(e.entries());try{for(i.s();!(t=i.n()).done;){var a=Object(A.a)(t.value,2),n=a[0],r=a[1];s[n]=[];var l,o=Object(N.a)(r.entries());try{for(o.s();!(l=o.n()).done;){var u=Object(A.a)(l.value,2),c=u[0],h=u[1],d=this.props.model.colour_map.find_colour(h);null==d&&(d=this.props.model.colour_map.new_colour(),this.props.model.colour_map.add_temp(h,d)),s[n][c]=[h,d]}}catch(p){o.e(p)}finally{o.f()}}}catch(p){i.e(p)}finally{i.f()}return s}},{key:"updateData",value:function(e){var t=this.createData(e);this.setState({data:t})}},{key:"drawCell",value:function(e,t,s,i){var a;if((a="square"===this.props.geometry?new q((t+.5)*this.props.size,(s+.5)*this.props.size):new q((t+(1&s)/2+.5)*this.props.size*Math.sin(2*Math.PI/6)*2*.75,(s+.5)*this.props.size*.75*2*.75)).x-this.props.size+this.state.offset.x>this.canvas.width/window.devicePixelRatio||a.y-this.props.size+this.state.offset.y>this.canvas.height/window.devicePixelRatio)return!1;if(a.x+this.props.size+this.state.offset.x<0||a.y+this.props.size+this.state.offset.y<0)return!1;if(void 0===i?e.fillStyle="rgba(0,0,0,0)":(e.fillStyle="rgb("+i[1].rgb().join(",")+")",e.strokeStyle=e.fillStyle),"square"===this.props.geometry)void 0===i?e.clearRect(a.x-this.props.size/2,a.y-this.props.size/2,this.props.size,this.props.size):e.fillRect(a.x-this.props.size/2,a.y-this.props.size/2,this.props.size,this.props.size);else if("hex"===this.props.geometry){e.beginPath();for(var n=0;n<6;n++)e.lineTo(a.x+this.props.size*[0,.645,.645,0,-.645,-.645][n],a.y+this.props.size*[.75,.375,-.375,-.75,-.375,.375][n]);e.closePath(),e.strokeStyle=e.fillStyle,e.stroke(),e.fill()}if(this.props.size>=12&&void 0!==i){var r=i[1].rgb(),l=Object(A.a)(r,3),o=l[0],u=l[1],c=l[2];e.fillStyle=.299*o+.587*u+.114*c>186?"black":"white",e.textAlign="center",e.textBaseline="middle",e.font="11px Arial",e.fillText(i[0],a.x,a.y,this.props.size)}return!0}}]),s}(a.a.Component),B=s(162),U=s.n(B),G=s(218),$=s.n(G),V=s(93),W=s.n(V),H=s(473),J=s(469),Y=s(479),Z=s(487),K=s(483),Q=s(485),X=s(474),ee=s(484),te=s(489),se=s(488),ie=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(d.a)(s,[{key:"render",value:function(){var e=this;return Object(I.jsx)(D.a,{item:!0,xs:12,sm:8,children:Object(I.jsxs)(Y.a,{sx:{height:"100%"},children:[Object(I.jsx)(K.a,{title:"Transition Rules"}),Object(I.jsx)(D.a,{container:!0,item:!0,id:"colour_container",sx:{"overflow-y":"auto","max-height":"20rem"},children:Object(I.jsx)(ee.a,{size:"small",children:Object(I.jsx)(X.a,{children:this.props.rules.map((function(t,s){return Object(I.jsx)(Q.a,{children:Object(I.jsx)(ae,{rule:t,deleteRule:function(){return e.props.deleteRule(t)}},t.toString()+s.toString())})}))})})}),Object(I.jsx)(Z.a,{children:Object(I.jsx)(H.a,{variant:"outlined",onClick:this.props.addRule,children:" Add Rule "})})]})})}}]),s}(a.a.Component),ae=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).rule=void 0,i.deleteRule=void 0,i.rule=e.rule,i.state={reactant0:e.rule.reactants[0],reactant1:!e.rule.is_mono&&e.rule.reactants.length>1?e.rule.reactants[1]:"",product0:e.rule.products[0],product1:!e.rule.is_mono&&e.rule.products.length>1?e.rule.products[1]:"",rate:e.rule.rate},i.deleteRule=e.deleteRule,i}return Object(d.a)(s,[{key:"render",value:function(){return Object(I.jsxs)(se.a,{hover:!0,children:[Object(I.jsxs)(te.a,{children:[" ",Object(I.jsx)(J.a,{variant:"filled",type:"number",value:this.state.rate,onChange:this.updateRule.bind(this),style:{width:"5rem"},inputProps:{inputMode:"numeric",step:.1,pattern:"[0-9]+(\\.[0-9]+)?",className:"rulesRate",min:0,style:{padding:"5px"}}})," "]}),Object(I.jsxs)(te.a,{padding:"none",children:[" ",Object(I.jsx)(J.a,{variant:"filled",value:this.state.reactant0,onChange:this.updateRule.bind(this),inputProps:{className:"rulesReactant0",style:{padding:"5px"}}})," "]}),Object(I.jsxs)(te.a,{padding:"none",align:"center",children:[" ",Object(I.jsx)(U.a,{})," "]}),Object(I.jsxs)(te.a,{padding:"none",align:"center",children:[" ",Object(I.jsx)(J.a,{variant:"filled",value:this.state.reactant1,className:"rulesReactant1",onChange:this.updateRule.bind(this),inputProps:{className:"rulesReactant1",style:{padding:"5px"}}})," "]}),Object(I.jsxs)(te.a,{padding:"none",align:"center",children:[" ",Object(I.jsx)($.a,{})," "]}),Object(I.jsxs)(te.a,{padding:"none",align:"center",children:[" ",Object(I.jsx)(J.a,{variant:"filled",value:this.state.product0,className:"rulesProduct0",onChange:this.updateRule.bind(this),inputProps:{className:"rulesProduct0",style:{padding:"5px"}}})," "]}),Object(I.jsxs)(te.a,{padding:"none",align:"center",children:[" ",Object(I.jsx)(U.a,{})," "]}),Object(I.jsxs)(te.a,{padding:"none",align:"center",children:[" ",Object(I.jsx)(J.a,{variant:"filled",value:this.state.product1,className:"rulesProduct1",onChange:this.updateRule.bind(this),inputProps:{className:"rulesProduct1",style:{padding:"5px"}}})," "]}),Object(I.jsxs)(te.a,{children:[" ",Object(I.jsxs)(z.a,{onClick:this.deleteRule,children:[" ",Object(I.jsx)(W.a,{})," "]})," "]})]})}},{key:"updateRule",value:function(e){var t=[this.state.reactant0,this.state.reactant1],s=[this.state.product0,this.state.product1],i=e.currentTarget.value;if(e.target.classList.contains("rulesReactant0")){t[0]=i;try{this.rule.update({reactants:t.filter((function(e){return""!==e}))})}catch(a){}this.setState({reactant0:i})}else if(e.target.classList.contains("rulesReactant1")){t[1]=i;try{this.rule.update({reactants:t.filter((function(e){return""!==e}))})}catch(n){}this.setState({reactant1:i})}else if(e.target.classList.contains("rulesProduct0")){s[0]=i;try{this.rule.update({products:s.filter((function(e){return""!==e}))})}catch(r){}this.setState({product0:i})}else if(e.target.classList.contains("rulesProduct1")){s[1]=i;try{this.rule.update({products:s.filter((function(e){return""!==e}))})}catch(l){}this.setState({product1:i})}else e.target.classList.contains("rulesRate")&&(s[1]=i,this.rule.update({rate:+i}),this.setState({rate:+i}))}}]),s}(a.a.Component),ne=s(76),re=s(221),le=s(219),oe=s.n(le),ue=s(220),ce=s.n(ue),he=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(){return Object(h.a)(this,s),t.apply(this,arguments)}return Object(d.a)(s,[{key:"render",value:function(){var e=this;return Object(I.jsx)(D.a,{item:!0,xs:12,sm:4,children:Object(I.jsxs)(Y.a,{sx:{height:"100%"},children:[Object(I.jsx)(K.a,{title:"Colour Mapping"}),Object(I.jsx)(D.a,{container:!0,item:!0,sx:{"overflow-y":"auto","max-height":"28rem",height:"100%"},children:Object(I.jsx)(X.a,{children:Object(u.a)(this.props.colour_map.colours.values()).map((function(t,s){return Object(I.jsx)(Q.a,{children:Object(I.jsx)(de,{colour:t,onChange:e.props.refreshColour,deleteColour:e.props.deleteColour})})}))})}),Object(I.jsx)(Z.a,{children:Object(I.jsx)(H.a,{variant:"outlined",onClick:this.props.addColour.bind(this),children:" Add Colour "})})]})})}}]),s}(a.a.Component),de=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).pickerRef=null,i.mouseDownInElement=!1,i.state={colour:e.colour.hex(),isOpen:!1,species:e.colour.species,name:e.colour.name,showList:!1},i.handleClickOutside=i.handleClickOutside.bind(Object(ne.a)(i)),i}return Object(d.a)(s,[{key:"handleClickOutside",value:function(e){this.mouseDownInElement||!this.pickerRef||this.pickerRef.contains(e.target)||this.setState({isOpen:!1})}},{key:"handleDownClick",value:function(e){this.mouseDownInElement=!this.pickerRef||this.pickerRef.contains(e.target)}},{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handleDownClick.bind(this)),document.addEventListener("mouseup",this.handleClickOutside.bind(this))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleDownClick),document.removeEventListener("mouseup",this.handleClickOutside)}},{key:"render",value:function(){var e=this;return Object(I.jsxs)(D.a,{item:!0,xs:12,children:[Object(I.jsxs)("div",{className:"picker",children:[Object(I.jsx)("div",{className:"swatch",style:{backgroundColor:this.props.colour.hex()},onClick:function(){return!e.state.isOpen&&e.setState({isOpen:!e.state.isOpen})}}),Object(I.jsx)(J.a,{variant:"filled",fullWidth:!0,margin:"none",label:"Name",value:this.state.name,onChange:function(t){var s=t.currentTarget.value;e.setState({name:s}),e.props.colour.name=s}}),Object(I.jsx)(z.a,{onClick:function(t){return e.setState({showList:!e.state.showList})},children:this.state.showList?Object(I.jsx)(oe.a,{}):Object(I.jsx)(ce.a,{})}),Object(I.jsx)(z.a,{onClick:function(t){return e.props.deleteColour(e.props.colour)},children:Object(I.jsx)(W.a,{})})]}),this.state.isOpen&&Object(I.jsx)("div",{className:"popover",ref:function(t){return e.pickerRef=t},children:Object(I.jsx)(re.a,{color:this.props.colour.hex(),onChange:function(t){e.setState({colour:t}),e.updateColour(t)}})}),Object(I.jsx)(X.a,{children:this.state.showList&&Object(I.jsxs)(Q.a,{children:[Object(I.jsx)(X.a,{children:Object(u.a)(this.state.species.values()).map((function(t){return Object(I.jsxs)(Q.a,{children:[Object(I.jsx)(J.a,{value:t.original_string,onChange:e.updateSpecies(t).bind(e),inputProps:{style:{padding:"5px"}}}),Object(I.jsxs)(z.a,{onClick:function(){return e.deleteMatcher(t)},children:[" ",Object(I.jsx)(W.a,{})," "]})]})}))}),Object(I.jsx)(H.a,{variant:"outlined",onClick:this.addMatcher.bind(this),children:" Add Species "})]})})]})}},{key:"updateColour",value:function(e){this.props.colour.update_colour(m.Colour.hex2rgb(e)),this.props.onChange()}},{key:"updateSpecies",value:function(e){var t=this;return function(s){e.update_matched(s.target.value),t.setState({species:t.props.colour.species}),t.props.onChange()}}},{key:"addMatcher",value:function(){this.props.colour.add_matcher(""),this.setState({species:this.props.colour.species})}},{key:"deleteMatcher",value:function(e){this.props.colour.delete_matcher(e),this.setState({species:this.props.colour.species})}}]),s}(a.a.Component),pe=s(470),fe=s(490),me=s(465),ve=s(468),_e=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var i;return Object(h.a)(this,s),(i=t.call(this,e)).state={example_selected:""},i}return Object(d.a)(s,[{key:"render",value:function(){var e=this;return Object(I.jsx)(D.a,{item:!0,xs:12,sm:4,children:Object(I.jsxs)(Y.a,{sx:{height:"100%"},children:[Object(I.jsx)(K.a,{title:"Import/Export"}),Object(I.jsxs)(D.a,{container:!0,children:[Object(I.jsx)(D.a,{item:!0,xs:12,sm:8,children:Object(I.jsxs)(fe.a,{fullWidth:!0,children:[Object(I.jsx)(pe.a,{id:"example-label",children:"Example"}),Object(I.jsx)(me.a,{label:"example-label",value:this.state.example_selected,onChange:function(t){return e.setState({example_selected:t.target.value})},autoWidth:!0,children:[{value:"./examples/two-bit-adder.txt",label:"Two Bit Adder"},{value:"./examples/two-bit-adder_new.txt",label:"Two Bit Adder New"},{value:"./examples/alternate_line_builder.txt",label:"Line Builder"},{value:"./examples/Brusselator.txt",label:"Brusselator"},{value:"./examples/busy_beaver.txt",label:"Busy Beaver"},{value:"./examples/ertl.txt",label:"Ertl Oscillator"},{value:"./examples/game_of_life_5x5_circuit.txt",label:"GoL Five by Five"},{value:"./examples/game_of_life_one_to_one.txt",label:"GoL One to One"},{value:"./examples/GH_big_spiral.txt",label:"Greenberg-Hastings Big spiral"},{value:"./examples/majority_asynchronous.txt",label:"Majority Asynchronous"},{value:"./examples/molecular_walker.txt",label:"Molecular Walker"},{value:"./examples/parens_matcher.txt",label:"Parens Matcher"},{value:"./examples/sierpinski_1D_synch.txt",label:"1D Sierpinski"},{value:"./examples/smarter_scout_ant.txt",label:"Smarter Scout Ant"}].map((function(e){return Object(I.jsxs)(ve.a,{value:e.value,children:[" ",e.label," "]})}))})]})}),Object(I.jsx)(D.a,{item:!0,xs:12,sm:4,children:Object(I.jsx)(H.a,{variant:"contained",disabled:""===this.state.example_selected,type:"submit",id:"import_example",onClick:function(){return e.props.import_example(e.state.example_selected)},children:" Import "})})]}),Object(I.jsxs)(Z.a,{children:[Object(I.jsxs)(H.a,{variant:"contained",component:"label",children:["Import File(s)",Object(I.jsx)("input",{type:"file",id:"import_input",multiple:!0,hidden:!0,onChange:this.props.import_code})]}),Object(I.jsx)(H.a,{variant:"contained",id:"export",onClick:this.props.export_code,children:" Export File "})]})]})})}}]),s}(a.a.Component),be=(s(409),s(410),s(411),s(412),s(464)),xe=s(466),ye=s(480),je=s(481),ge=s(482),Oe=s(222),we=s.n(Oe),ke=s(223),Se=s.n(ke),Ce=s(224),Re=s(476),Pe=Object(Ce.a)({palette:{mode:"dark",primary:{main:"#2e7d32"},secondary:{main:"#f50057"}}}),Me=function(e){Object(p.a)(s,e);var t=Object(f.a)(s);function s(e){var i;Object(h.a)(this,s),(i=t.call(this,e)).initial_state_component=null,i.transition_state_component=null,i.simulator_component=null,i.header_component=null,i.model_tabs=null,i.toolbarInput=null;var a=new v.a({geometry:"square",initial_state:Array.from({length:20},(function(){return Array.from({length:20},(function(){return"I"}))}))});return i.state={shown_tab:0,model:a,sim_size:a.pixels_per_node,geometry:a.geometry,colour_map:a.colour_map,rules:a.rules,playing_simulation:!1,editValue:"",selectedCells:[],rngSeed:(a.rng_seed||"").toString(),fps:a.fps,speedup_factor:a.speedup_factor},i}return Object(d.a)(s,[{key:"render",value:function(){var e,t=this;return Object(I.jsxs)(Re.a,{theme:Pe,children:[Object(I.jsx)(be.a,{}),Object(I.jsxs)(D.a,{container:!0,spacing:1,sx:{margin:"auto",width:"98%",height:"98%"},children:[Object(I.jsx)(T,{playPressed:this.playPressed.bind(this),stepBackPressed:this.stepBackwardPressed.bind(this),stepForwardPressed:this.stepForwardPressed.bind(this),fastBackwardPressed:this.fastBackwardPressed.bind(this),fastForwardPressed:this.fastForwardPressed.bind(this),stopPressed:this.stopPressed.bind(this),simPlaying:this.state.playing_simulation,ref:function(e){return t.header_component=e}}),Object(I.jsx)(D.a,{item:!0,xs:12,sm:8,children:Object(I.jsx)(Y.a,{sx:{height:"35rem"},children:Object(I.jsxs)(D.a,{container:!0,sx:{height:"100%"},children:[Object(I.jsxs)(D.a,{item:!0,xs:12,sx:{height:"20%"},children:[Object(I.jsxs)(xe.a,{value:this.state.shown_tab,onChange:this.onTabSelect.bind(this),children:[Object(I.jsx)(ye.a,{label:"Initial State"}),Object(I.jsx)(ye.a,{label:"Simulator"})]}),Object(I.jsxs)(je.a,{style:{display:"inline"},children:[0===this.state.shown_tab&&Object(I.jsxs)(je.a,{children:[Object(I.jsx)(E.a,{variant:"overline",sx:{"font-size":20,margin:"5px"},children:" Editing Options "}),Object(I.jsx)(J.a,{label:"",size:"small",variant:"filled",value:this.state.editValue,onChange:this.updateSelectedCells.bind(this),inputRef:function(e){return t.toolbarInput=e}}),Object(I.jsx)(z.a,{"aria-label":"Type",onClick:this.changeGeometry.bind(this),children:"hex"===this.state.model.geometry?Object(I.jsx)(we.a,{}):Object(I.jsx)(Se.a,{})}),Object(I.jsx)(J.a,{label:"Random Seed",value:this.state.rngSeed,onChange:this.setRNGseed.bind(this),size:"small"})]}),1===this.state.shown_tab&&Object(I.jsxs)(je.a,{children:[Object(I.jsx)(E.a,{variant:"overline",sx:{"font-size":20,margin:"5px"},children:" Playback Options "}),Object(I.jsx)(J.a,{label:"Speed",size:"small",variant:"filled",value:this.state.speedup_factor,onChange:this.updateSpeedUp.bind(this),InputProps:{type:"number"},style:{width:"10%"}}),Object(I.jsx)(J.a,{label:"FPS",size:"small",variant:"filled",value:this.state.fps,onChange:this.updateFPS.bind(this),InputProps:{type:"number"},style:{width:"10%"}}),Object(I.jsx)(J.a,{label:"Random Seed",value:1===this.state.shown_tab?null===(e=this.state.model.random)||void 0===e?void 0:e.seed.toString():this.state.rngSeed,onChange:this.setRNGseed.bind(this),disabled:1===this.state.shown_tab,InputProps:{endAdornment:1===this.state.shown_tab?Object(I.jsx)(ge.a,{position:"end",children:Object(I.jsx)(H.a,{onClick:this.copyRNGseed.bind(this),children:"Set"})}):null},size:"small"})]})]})]}),Object(I.jsxs)(D.a,{item:!0,xs:12,sx:{height:"80%"},children:[0===this.state.shown_tab&&Object(I.jsx)(L,{current_state:this.state.model.initial_state,model:this.state.model,geometry:this.state.geometry,ref:function(e){return t.initial_state_component=e},size:this.state.sim_size,zoom:this.zoom.bind(this),selectedCells:this.selectedCells.bind(this)}),1===this.state.shown_tab&&Object(I.jsx)(L,{current_state:this.state.model.sim_started()?this.state.model.current_state:this.state.model.initial_state,model:this.state.model,geometry:this.state.geometry,ref:function(e){return t.simulator_component=e},size:this.state.sim_size,zoom:this.zoom.bind(this),selectedCells:this.selectedCells.bind(this),simulation:!0})]})]})})}),Object(I.jsx)(he,{model:this.state.model,refreshColour:this.refreshColour.bind(this),addColour:this.addColour.bind(this),deleteColour:this.deleteColour.bind(this),colour_map:this.state.colour_map}),Object(I.jsx)(ie,{ref:function(e){return t.transition_state_component=e},model:this.state.model,addRule:this.addRule.bind(this),deleteRule:this.deleteRule.bind(this),rules:this.state.rules}),Object(I.jsx)(_e,{export_code:this.export_code.bind(this),import_code:this.import_code.bind(this),import_example:this.import_example.bind(this)})]})]})}},{key:"import_code",value:function(){var e=Object(c.a)(o.a.mark((function e(){var t,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=document.getElementById("import_input").files)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,v.a.parser.parse_import_files(Object(u.a)(t));case 5:!1===(s=e.sent)||this.update_page(s);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"export_code",value:function(){var e=this.state.model.export(),t=new Blob([e],{type:"text/plain"}),s=document.createElement("a");s.download="surface_crn_export.txt",s.href=(window.webkitURL||window.URL).createObjectURL(t),s.dataset.downloadurl=["text/plain",s.download,s.href].join(":"),s.click()}},{key:"import_example",value:function(e){if(""!==e){var t=this;fetch(e,{headers:{"Content-Type":"application/text",Accept:"application/text"}}).then((function(e){return e.text()})).then((function(e){var s=v.a.parser.parse_code(e.split("\n"));t.update_page(s)}))}}},{key:"setPlaying",value:function(e){this.setState({playing_simulation:e})}},{key:"update_page",value:function(e){this.setState({shown_tab:0,playing_simulation:!1,model:e,geometry:e.geometry,sim_size:e.pixels_per_node,colour_map:e.colour_map,rules:Object(u.a)(e.rules),editValue:"",selectedCells:[],rngSeed:(e.rng_seed||"").toString(),fps:e.fps,speedup_factor:e.speedup_factor})}},{key:"changeGeometry",value:function(){"hex"===this.state.model.geometry?this.state.model.geometry="square":"square"===this.state.model.geometry&&(this.state.model.geometry="hex"),this.setState({geometry:this.state.model.geometry}),this.refreshSimState(),this.refreshInitState()}},{key:"refreshInitState",value:function(){null!==this.initial_state_component&&this.initial_state_component.setState({colour_map:this.state.model.colour_map,geometry:this.state.model.geometry,size:this.state.model.pixels_per_node,data:this.initial_state_component.createData(this.state.model.initial_state)})}},{key:"refreshSimState",value:function(){var e=this.simulator_component,t=this.state.model;null!==e&&e.setState({colour_map:t.colour_map,size:t.pixels_per_node,data:e.createData(t.sim_started()?t.current_state:t.initial_state),sim_time:t.sim_time})}},{key:"refreshColour",value:function(){this.refreshInitState(),this.refreshSimState()}},{key:"startSimulation",value:function(){this.state.model.start_sim(),this.refreshSimState(),this.setState({rngSeed:this.state.model.random.seed.toString()})}},{key:"showSimulation",value:function(){1!==this.state.shown_tab&&this.setState({shown_tab:1}),this.state.model.sim_started()||this.startSimulation()}},{key:"onTabSelect",value:function(e,t){this.setState({shown_tab:t}),1===t&&this.startSimulation()}},{key:"playPressed",value:function(e){e.preventDefault(),this.showSimulation(),this.state.playing_simulation?this.setPlaying(!1):(this.setPlaying(!0),this.playSimulation(!0))}},{key:"playSimulation",value:function(e){if(e||this.state.playing_simulation){var t=this.state.model.next_frame();this.refreshSimState(),t?window.setTimeout(this.playSimulation.bind(this),1/this.state.model.fps):this.setPlaying(!1)}}},{key:"stepForwardPressed",value:function(e){e.preventDefault(),this.showSimulation(),this.state.model.step_forward(),this.refreshSimState()}},{key:"stepBackwardPressed",value:function(e){e.preventDefault(),this.showSimulation(),this.state.model.step_backward(),this.refreshSimState()}},{key:"fastForwardPressed",value:function(e){e.preventDefault(),this.showSimulation(),this.state.model.next_frame(),this.refreshSimState()}},{key:"fastBackwardPressed",value:function(e){e.preventDefault(),this.showSimulation(),this.state.model.prev_frame(),this.refreshSimState()}},{key:"stopPressed",value:function(e){e.preventDefault(),this.setPlaying(!1),this.state.model.stop_sim(),this.refreshSimState()}},{key:"addColour",value:function(){var e=this.state.model.colour_map.new_colour();this.state.model.colour_map.add(Object.assign(e,{name:"New"})),this.setState({colour_map:this.state.model.colour_map})}},{key:"deleteColour",value:function(e){this.state.model.colour_map.delete(e),this.setState({colour_map:this.state.model.colour_map})}},{key:"deleteRule",value:function(e){this.state.model.remove_rule(e),this.setState({rules:Object(u.a)(this.state.model.rules)})}},{key:"addRule",value:function(){this.state.model.add_rule(),this.setState({rules:Object(u.a)(this.state.model.rules)})}},{key:"zoom",value:function(e){var t=this.state.model.pixels_per_node;return e?this.state.model.increase_size():this.state.model.decrease_size(),this.setState({sim_size:this.state.model.pixels_per_node}),t/this.state.model.pixels_per_node}},{key:"selectedCells",value:function(e,t){this.setState({selectedCells:e,editValue:t}),this.toolbarInput&&this.toolbarInput.focus()}},{key:"updateSelectedCells",value:function(e){e.target.value.match(/^\w*$/)&&(this.setState({editValue:e.target.value}),this.state.model.set_cells(this.state.selectedCells.map((function(e){return[e.x,e.y]})),e.target.value),this.refreshInitState())}},{key:"setRNGseed",value:function(e){var t=e.target.value;if(""===t)this.setState({rngSeed:t}),this.state.model.rng_seed=null;else{var s=parseInt(t);this.setState({rngSeed:t}),this.state.model.rng_seed=s}}},{key:"copyRNGseed",value:function(){this.state.model.rng_seed=this.state.model.random.seed,this.setState({rngSeed:this.state.model.rng_seed.toString()})}},{key:"updateFPS",value:function(e){var t=e.target.value,s=parseFloat(t);this.setState({fps:s}),this.state.model.fps=s}},{key:"updateSpeedUp",value:function(e){var t=e.target.value,s=parseFloat(t);this.setState({speedup_factor:s}),this.state.model.speedup_factor=s}}]),s}(a.a.Component);r.a.render(Object(I.jsxs)(a.a.StrictMode,{children:[Object(I.jsx)("title",{children:" Surface CRN Simulator "}),Object(I.jsx)(Me,{})]}),document.getElementById("root"))},68:function(e,t,s){"use strict";var i=s(170),a=s(130),n=s(98),r=s(43),l=s(47),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Colour=t.Colour_Map=t.Transition_Rule=t.Species_Matcher=void 0;var u=o(s(131));t.Species_Matcher=u.default;var c=o(s(207));t.Transition_Rule=c.default;var h=o(s(395));t.Colour_Map=h.default;var d=o(s(152));t.Colour=d.default;var p=o(s(396)),f=s(397),m=o(s(399)),v=s(413),_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.initial_state=[],this.rules=[],this.colour_map=new h.default,this.options=new Map,this.geometry="square",this.rng_seed=null,this.pixels_per_node=20,this.speedup_factor=1,this.fps=30,this.random=null,this.current_state=[],this.last_updated=[],this.sim_time=0,this.sim_queue=null,this.sim_history=[],this.rule_check_cache={},Object.assign(this,t)}return l(e,[{key:"remove_rule",value:function(e){this.rules.splice(this.rules.indexOf(e),1)}},{key:"add_rule",value:function(){this.rules.push(c.default.blankRule())}},{key:"set_cells",value:function(e,t){var s=this;if(0!==e.length){var r=e.map((function(e){return e[0]})).sort(),l=r[0],o=r[r.length-1];if(l<0){var u,c=n(this.initial_state);try{for(c.s();!(u=c.n()).done;){var h=u.value;h.unshift.apply(h,a(Array(-l).fill("")))}}catch(S){c.e(S)}finally{c.f()}o-=l}var d=this.initial_state[0].length;if(o>=d){var p,f=n(this.initial_state);try{for(f.s();!(p=f.n()).done;){var m=p.value;m.push.apply(m,a(Array(o-d+1).fill("")))}}catch(S){f.e(S)}finally{f.f()}}var v,_,b=e.map((function(e){return e[1]})).sort(),x=b[0],y=b[b.length-1];if(x<0)(v=this.initial_state).unshift.apply(v,a(Array(-x).map((function(e){return Array(s.initial_state[0].length).fill("")})))),y-=x;if(y>=this.initial_state.length)(_=this.initial_state).push.apply(_,a(Array(y-this.initial_state.length+1).fill("").map((function(e){return Array(s.initial_state[0].length).fill("")}))));var j,g=n(e);try{for(g.s();!(j=g.n()).done;){var O=i(j.value,2),w=O[0],k=O[1];this.initial_state[k][w]=t}}catch(S){g.e(S)}finally{g.f()}}}},{key:"set_option",value:function(e,t){switch(e){case"geometry":if("square"!==t&&"hex"!==t)throw"Invalid option: Geometry";this.geometry=t;break;case"rng_seed":var s=parseInt(t);this.rng_seed=s;break;case"pixels_per_node":s=parseFloat(t);this.pixels_per_node=s;break;case"speedup_factor":s=parseFloat(t);this.speedup_factor=s;break;case"fps":s=parseFloat(t);this.fps=s}this.options.set(e,t)}},{key:"export",value:function(){var e,t=[],s=n(this.options);try{for(s.s();!(e=s.n()).done;){var r=i(e.value,2),l=r[0],o=r[1];t.push(l+" = "+o)}}catch(u){s.e(u)}finally{s.f()}return t.push("!START_TRANSITION_RULES"),t.push.apply(t,a(this.rules.map((function(e){return e.toString()})))),t.push("!END_TRANSITION_RULES\n"),t.push(["!START_COLORMAP"]),t.push.apply(t,a(this.colour_map.export())),t.push(["!END_COLORMAP\n"]),t.push(["!START_INIT_STATE"]),t.push.apply(t,a(this.initial_state.map((function(e){return e.join(" ")})))),t.push(["!END_INIT_STATE\n"]),t.join("\n")}},{key:"stop_sim",value:function(){this.current_state=[],this.last_updated=[],this.sim_time=0,this.sim_queue=null,this.sim_history=[],this.rule_check_cache={},this.colour_map.clear_temp()}},{key:"start_sim",value:function(){var e=this;if(!this.sim_started()){null!==this.rng_seed?this.random=new v.MersenneTwister(this.rng_seed):(this.random=new v.MersenneTwister,this.random=new v.MersenneTwister(this.random.int())),this.sim_queue=new m.default({comparator:function(e,t){return e.execution_time-t.execution_time}});var t=[];this.initial_state.forEach((function(s,i){e.last_updated.push(Array(s.length).fill(0)),e.current_state.push([]),s.forEach((function(s,a){e.current_state[e.current_state.length-1].push(e.initial_state[i][a]);var r,l=e.find_next_transitions(a,i),o=n(l);try{for(o.s();!(r=o.n()).done;){var u=r.value;t.push(u)}}catch(c){o.e(c)}finally{o.f()}}))})),this.sim_queue=new m.default({comparator:function(e,t){return e.execution_time-t.execution_time},initialValues:t})}}},{key:"get_next_transition",value:function(){var e=this;if(this.sim_started()){for(var t=function(){var t=e.sim_queue.peek();if(t.new_cells.every((function(s){var a=i(s,3),n=a[0],r=a[1];a[2];return e.last_updated[r][n]<=t.update_time})))return"break";e.sim_queue.dequeue()};0!=this.sim_queue.length;){if("break"===t())break}return 0!=this.sim_queue.length&&this.sim_queue.peek()}return!1}},{key:"run_upto",value:function(e){for(;this.sim_time<e;){var t=this.get_next_transition();if(!1===t)return!1;if(t.execution_time>e)break;this.step_forward()}return this.sim_time=e,!0}},{key:"run_backto",value:function(e){for(;this.sim_time>e;){if(!1===this.step_backward())return!1}return this.sim_time=e,!0}},{key:"next_frame",value:function(){return this.run_upto(this.sim_time+1*this.speedup_factor/this.fps)}},{key:"prev_frame",value:function(){return this.run_backto(this.sim_time-1*this.speedup_factor/this.fps)}},{key:"step_forward",value:function(){var e=this;if(this.sim_started()){var t=this.get_next_transition();if(!1===t)return!1;if(this.sim_queue.dequeue(),this.sim_time=t.execution_time,t.new_cells.forEach((function(t){var s=i(t,3),a=s[0],n=s[1],r=s[2];e.current_state[n][a]=r,e.last_updated[n][a]=e.sim_time})),null===t.new_transitions){t.new_transitions=[];var s=new Set;t.new_cells.forEach((function(a){var r,l=i(a,3),o=l[0],u=l[1],c=(l[2],e.find_next_transitions(o,u,s)),h=n(c);try{for(h.s();!(r=h.n()).done;){var d=r.value;e.sim_queue.queue(d),t&&t.new_transitions.push(d)}}catch(p){h.e(p)}finally{h.f()}s.add([o,u])}))}else t.new_transitions.forEach((function(t){e.sim_queue.queue(t)}));return this.sim_history.push(t),0!=this.sim_queue.length}return!1}},{key:"step_backward",value:function(){var e=this;if(this.sim_started()){var t=this.sim_history.pop();return void 0!==t&&(this.sim_time=t.execution_time,t.old_cells.forEach((function(t){var s=i(t,3),a=s[0],n=s[1],r=s[2];e.current_state[n][a]=r,e.last_updated[n][a]=0})),this.sim_queue.queue(t),!0)}return!1}},{key:"find_next_transitions",value:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,a=this.current_state[t][e],r=[],l=[],o=this.rule_check_cache[a];l=void 0===o?this.rules:o;var u,c=n(l);try{for(c.s();!(u=c.n()).done;){var h=u.value;if(h.is_mono){var d,f=h.matches(a),m=n(f);try{for(m.s();!(d=m.n()).done;){var v=d.value,_=this.sim_time+Math.log(1/this.random.float())/h.rate,b=new p.default(this.sim_time,_);b.add_old_cell(e,t,a),b.add_new_cell(e,t,v[0]),r.push(b)}}catch(A){m.e(A)}finally{m.f()}}else{var x=[];x="square"==this.geometry?[[-1,0],[0,-1],[1,0],[0,1]]:[[1,0],[-1,0],[0,1],[t%2?1:-1,1],[0,-1],[t%2?1:-1,-1]];for(var y=0,j=x;y<j.length;y++){var g=i(j[y],2),O=g[0],w=g[1];if(t+w>=0&&t+w<this.current_state.length&&e+O>=0&&e+O<this.current_state[t+w].length){if(s.has([e+O,t+w]))continue;var k,S=this.current_state[t+w][e+O],C=h.matches(a,S),R=n(C);try{for(R.s();!(k=R.n()).done;){var P=k.value,M=this.sim_time+Math.log(1/this.random.float())/h.rate,z=new p.default(this.sim_time,M);z.add_old_cell(e,t,a),z.add_old_cell(e+O,t+w,S),z.add_new_cell(e,t,P[0]),z.add_new_cell(e+O,t+w,P[1]),r.push(z)}}catch(A){R.e(A)}finally{R.f()}C=h.matches(S,a);var E,D=n(C);try{for(D.s();!(E=D.n()).done;){var I=E.value,T=this.sim_time+Math.log(1/this.random.float())/h.rate,N=new p.default(this.sim_time,T);N.add_old_cell(e,t,a),N.add_old_cell(e+O,t+w,S),N.add_new_cell(e,t,I[1]),N.add_new_cell(e+O,t+w,I[0]),r.push(N)}}catch(A){D.e(A)}finally{D.f()}}}}}}catch(A){c.e(A)}finally{c.f()}return r}},{key:"sim_started",value:function(){return null!==this.sim_queue}},{key:"increase_size",value:function(){this.pixels_per_node<1?this.pixels_per_node=1/(1/this.pixels_per_node-1):this.pixels_per_node+=1}},{key:"decrease_size",value:function(){this.pixels_per_node<=1?this.pixels_per_node=1/(1/this.pixels_per_node+1):this.pixels_per_node-=1}}]),e}();t.default=_,_.parser={parse_import_files:f.parse_import_files,parse_code:f.parse_code}}},[[414,1,2]]]);
//# sourceMappingURL=main.929c2408.chunk.js.map